"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[400],{36024:function(t,e,n){n.d(e,{Dn:function(){return W},LV:function(){return Q},Ll:function(){return R},N4:function(){return D},OL:function(){return J},Ok:function(){return G},T8:function(){return Vt},VT:function(){return K},Xx:function(){return Wt},d1:function(){return le},fY:function(){return Rt},gJ:function(){return H},gP:function(){return v},mA:function(){return se},oh:function(){return X},py:function(){return Z},vq:function(){return V},xn:function(){return A},yO:function(){return Yt},zI:function(){return B}});var r,a,o,i,l=n(14924),s=n(79230),c=n(87066),d=n(91819),h=n(36100),u=n(48764).lW,g=Object.defineProperty,f=(t,e)=>g(t,"name",{value:e,configurable:!0}),m=!1;f(r=class{get onload(){return this._onload}set onload(t){this._onload=t,this._realImage.onload=t}get onerror(){return this._onerror}set onerror(t){this._onerror=t,this._realImage.onerror=t}get realImage(){return this._realImage}get src(){return this._src}set src(t){this._src=t,this._imageLoaded=!1,this._realImage.src=t}get width(){return this._realImage.width}get height(){return this._realImage.height}get complete(){return this._imageLoaded}constructor(){(0,l.Z)(this,"_onload",null),(0,l.Z)(this,"_onerror",null),(0,l.Z)(this,"_src",""),(0,l.Z)(this,"_imageLoaded",!1),(0,l.Z)(this,"_realImage",void 0),this._realImage=new window.Image}},"ImageWrapper");var p=!1;a=class{parseFromString(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text/html";return this.parser.parseFromString(t,e)}constructor(){(0,l.Z)(this,"parser",void 0),this.parser=new DOMParser}},f(a,"DOMParserWrapper");f(o=class{constructor(t,e,n){return new File(t,e,n)}},"FileWrapper");function v(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e({width:r.width,height:r.height}),r.onerror=()=>n(new Error("Error loading image")),r.src=t}))}f((function(t){return new Promise(((e,n)=>{const r=new Image;r.onload=function(){const t=y(r.width,r.height),a=t.getContext("2d");if(!a)return n(new Error("Failed to get canvas context"));t.width=r.width,t.height=r.height;const o=r.realImage?r.realImage:r;a.drawImage(o,0,0);const i=a.getImageData(0,0,t.width,t.height).data;let l=t.width,s=t.height,c=0,d=0;for(let e=0;e<t.height;e++)for(let n=0;n<t.width;n++){i[4*(e*t.width+n)+3]>0&&(l=Math.min(l,n),s=Math.min(s,e),c=Math.max(c,n),d=Math.max(d,e))}const h=c-l,u=d-s,g=y(h,u),f=g.getContext("2d");if(!f)return n(new Error("Failed to get canvas context"));g.width=h,g.height=u,f.drawImage(t,l,s,h,u,0,0,h,u),e(g.toDataURL("image/png"))},r.onerror=()=>n(new Error("Error loading image")),r.src=t}))}),"cropImage"),f((function(t){return new Promise(((e,n)=>{const r=new Image;r.onload=function(){const t=y(r.width,r.height);t.width=r.width,t.height=r.height;const a=t.getContext("2d");if(!a)return n(new Error("Failed to get canvas context"));const o=r.realImage?r.realImage:r;a.drawImage(o,0,0);const i=a.getImageData(0,0,t.width,t.height).data;e(i.every((t=>0===t)))},r.onerror=()=>n(new Error("Error loading image")),r.src=t}))}),"isBlankImage"),f(v,"getImageDimension"),f((function(t,e,n){return new Promise(((e,r)=>{if(!t)return e(null);const a=new Image;a.onload=function(){const t=y(a.width,a.height),o=t.getContext("2d");if(!o)return r(new Error("Failed to get canvas context"));t.width=a.width,t.height=a.height;const i=a.realImage?a.realImage:a;o.drawImage(i,0,0);const l=o.getImageData(0,0,t.width,t.height),s=l.data,c=Math.floor(n/100*(t.width*t.height));for(let e=0;e<c;e++){const e=Math.floor(Math.random()*t.width);s[4*(Math.floor(Math.random()*t.height)*t.width+e)+3]=0}o.putImageData(l,0,0),e(t.toDataURL("image/png"))},a.onerror=()=>r(new Error("Error loading image")),a.src=t}))}),"imageToStamp"),f((function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((n,r)=>{if(!t)return n(null);const a=new Image;a.onload=function(){const t=y(a.width,a.height),o=t.getContext("2d");if(!o)return r(new Error("Failed to get canvas context"));t.width=a.width,t.height=a.height;const i=a.realImage?a.realImage:a;o.drawImage(i,0,0);const l=o.getImageData(0,0,t.width,t.height).data;let s=0,c=0,d=0,h=0;const u={};for(let e=0;e<l.length;e+=4){const t=l[e],n=l[e+1],r=l[e+2];s+=t,c+=n,d+=r,h++;const a="".concat(t,",").concat(n,",").concat(r);u[a]=(u[a]||0)+1}const g=[Math.round(s/h),Math.round(c/h),Math.round(d/h)];if(e){let t=g,e=0;for(const n in u)u[n]>e&&(t=n.split(",").map(Number),e=u[n]);n(t)}else n(g)},a.onerror=()=>r(new Error("Error loading image")),a.src=t}))}),"getImageColor"),f((function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return new Promise(((r,a)=>{const o=new Image;o.onload=()=>{const{width:a,height:i}=o;if(e>a)return r(t);let l=e*(i/a);0!=e&&e!=a||(e=a,l=i);const s=y(e,l);s.width=e,s.height=l;const c=s.getContext("2d"),d=o.realImage?o.realImage:o;0!=e&&0!=l&&d||console.log("invimg:2",e,l,d),c.drawImage(d,0,0,e,l);const h=t.match(/^data:(.+);base64,(.+)$/);let u;if(h){const t=h[1];u=s.toDataURL(t,n)}else u=s.toDataURL();r(u)},o.onerror=t=>a(t),o.src=t}))}),"reduceBase64Image");var w=f((function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return new Promise(((n,r)=>{const a=new Image,o=setTimeout((()=>{r(new Error("Image load timeout: ".concat(t)))}),e);a.onload=()=>{clearTimeout(o);const t=a.realImage?a.realImage:a;n(t)},a.onerror=e=>{clearTimeout(o),r(new Error("Error loading image: ".concat(t.substring(0,30)),e))},a.src=t}))}),"loadImageWithTimeout"),y=f(((t,e)=>document.createElement("canvas")),"getCanvas"),b=f((async function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!j(e))return e;try{const n=await c.Z.get(tt(e,t),{responseType:"arraybuffer"}),r=u.from(n.data),a=n.headers["content-type"]||"application/octet-stream",o=r.toString("base64");return"data:".concat(a,";base64,").concat(o)}catch(r){if(console.info("fetchImageForBase64 error:",r.message),n)return null;throw r}}),"fetchImageForBase64");function x(t,e){return console.info("parsedSvg:base64A: ",t.substring(0,32)),console.info("parsedSvg:base64B: ",e.substring(0,32)),t===e.split(",")[1]}function I(t,e){try{const n=new URL(t);return n.searchParams.delete(e),n.toString()}catch(n){return console.error("Invalid URL:",n,t),t}}function F(t){return I(t,"updates")}function S(t,e,n){return new Promise((async(r,a)=>{try{for(const r in e)if(e.hasOwnProperty(r)&&n.hasOwnProperty(r)){const a=e[r],o=n[r];if(a.startsWith("http")&&o.startsWith("data:image")){const e=await b(t,a,!0);e&&x(e,o)&&(n[r]=a)}}r(n)}catch(o){a(o)}}))}f(x,"compareBase64"),f(I,"removeQueryString"),f(F,"removeUpdateQueryString"),f((function(t){const e=new URL(t),n=e.searchParams.get("updates"),r="".concat(n?parseInt(n,10)+1:1);return e.searchParams.set("updates",r),e.toString()}),"incrementUpdateQueryString"),f((function(t){const e=new URL(t).searchParams.get("updates");return e?parseInt(e,10):1}),"getUrlUpdatesCount"),f(S,"mergeImages"),f((function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new Promise(((a,o)=>{const i=new Image;i.onload=()=>{const t=y(e,n),l=t.getContext("2d");if(!l)return o("No canvas context");t.width=e,t.height=n,l.globalAlpha=r;for(let r=0;r<n;r+=i.height)for(let t=0;t<e;t+=i.width)l.drawImage(i,t,r,i.width,i.height);a(t.toDataURL())},i.onerror=o,i.src=t}))}),"generateWatermark");var M=f((t=>{try{return t.toDate()}catch(e){return t}}),"timestampToDate"),_=({writable:!0,value:void f(i=class{random(){const t=1e4*Math.sin(this.seed++);return t-Math.floor(t)}randomInt(t,e){return Math.floor(this.random()*(e-t+1))+t}constructor(t){(0,l.Z)(this,"seed",void 0),this.seed=t}},"SeededRandom")},i);function C(t,e,n,r){if(null===t||void 0===t||null===n||void 0===n||null===e||void 0===e||null===r||void 0===r)return 0;const a=(t+Object.keys(n).filter((t=>r(t))).map((t=>n[t].toString().replace(/\s+/g,""))).join("")+e.toString()).toLowerCase();let o=0;for(let i=0;i<a.length;i++)o=(o<<5)-o+a.charCodeAt(i),o|=0;return o}function E(t,e){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=["January","February","March","April","May","June","July","August","September","October","November","December"];return{YYYY:t.getFullYear().toString(),YY:String(t.getFullYear()).slice(-2),MMMM:r[t.getMonth()],MMM:r[t.getMonth()].slice(0,3),MM:String(t.getMonth()+1).padStart(2,"0"),M:(t.getMonth()+1).toString(),DD:String(t.getDate()).padStart(2,"0"),D:t.getDate().toString(),dddd:n[t.getDay()],ddd:n[t.getDay()].slice(0,3),HH:String(t.getHours()).padStart(2,"0"),H:t.getHours().toString(),hh:String(t.getHours()%12||12).padStart(2,"0"),h:(t.getHours()%12||12).toString(),mm:String(t.getMinutes()).padStart(2,"0"),m:t.getMinutes().toString(),ss:String(t.getSeconds()).padStart(2,"0"),s:t.getSeconds().toString(),A:t.getHours()<12?"AM":"PM",a:t.getHours()<12?"am":"pm"}[e]||""}function P(t,e,n,r){if(!t||!e)return"";function a(t){return t.split(" ")}function o(r,a,o){const i=n?C(t,o,e,n):1e6*Math.random(),l=new _(i),s=f((t=>"string"===typeof t&&t.endsWith("d")),"isDigits"),c=f((t=>!isNaN(t)&&!s("".concat(t))),"isNumber");if(c(r)&&c(a))return l.randomInt(parseInt(r),parseInt(a)).toString();if(s(r)&&s(a)){const t=parseInt(r),e=parseInt(a);let n="",o=0;const i=l.randomInt(t,e);for(;o<i;){n+=l.randomInt(1,9).toString(),o=n.length}return n}if(s(r)){const t=parseInt(r);let e=l.randomInt(1,9).toString();for(let n=1;n<t;n++){e+=l.randomInt(0,9).toString()}return e}return c(r)?Math.round(l.random()*parseInt(r)).toString():"Invalid arguments for randomNumber function: Min: ".concat(r," - ").concat(typeof r," | Max: ").concat(a," - ").concat(typeof a)}function i(t){if(!e)return"";const n=(t=t.replace(/[{}]+/g,"")).match(/(.+)\[w(\d+)\]/);if(n){const[,t,o]=n;return a((r?r(t,e[t]||""):e[t])||"")[parseInt(o)-1]||""}if(t in e){return r?r(t,e[t]||""):e[t]}return""}function l(t){const e=/{([^{}]+?)}(\.\w+\[(.*?)\])?/g,n=[];let r;for(;null!==(r=e.exec(t));){const t=r[1],e=r[2]?r[2].split("[")[0].slice(1):null,a=r[3]?r[3].split(",").map((t=>t.trim())):[],o=r.index,i=r.index+r[0].length-1,l={varKey:t,varFunc:e||void 0,varFuncArgs:a.length?a:void 0,replacementStart:o,replacementEnd:i};n.push(l)}return n}function s(t,e,n,r){return t.slice(0,n)+e+t.slice(r+1)}function c(t,e,n){var r=parseInt(e),a=parseInt(n||"");return isNaN(a)?t.substring(r-1):t.substring(r-1,a)}function d(t,e,n){var r=null;switch(e){case"cut":if(n&&[1,2].includes(n.length))try{r=c(t,n[0],n[1])}catch(o){}break;case"df":if(n&&[1,2,3].includes(n.length))try{var a=n[0];r=E("_"==t?new Date:M(t),a),n.length>1&&(r=c(r,n[1],n[2]))}catch(o){console.log(o)}}return r}f(a,"getWords"),f(o,"randomNumber"),f(i,"substituteVariable"),f(l,"extractVariables"),f(s,"replaceSubtext"),f(c,"cut"),f(d,"callVarFunc");const h=[];let u=0,g=t.replace(/\(([^()]*)\)/g,((t,e)=>{if(e.startsWith("rn[")){const[t,n]=e.slice(3,-1).split(",");return o(t,n,u++)}if(e.match(/^([^*]+)(\*{1,2})(\d+)$/)){const[,t,n,r]=e.match(/^([^*]+)(\*{1,2})(\d+)$/)||[],a=parseInt(r);if("*"==n)return t.repeat(a);{const e="<".concat(Math.floor(1e9*Math.random()),">");return h.push({id:e,char:t,count:a}),e}}if(e.includes("{")&&e.includes("}")){var n=l(e);n.sort(((t,e)=>e.replacementStart-t.replacementStart));for(const t of n){var r=i(t.varKey);if(t.varFunc&&(r=d(r,t.varFunc,t.varFuncArgs)),!(r&&e.length>0)){e="";break}e=s(e,r,t.replacementStart,t.replacementEnd)}return e}return e}));for(const f of h){const t=g.length-f.id.length;if(t>=f.count)break;const e=f.char.repeat(f.count-t);g=g.replace(f.id,e)}return g}f(C,"createSeed"),f(E,"formatDate"),f(P,"textGenCodeParser");var k=f((t=>void 0===t||null===t),"isVoid"),D=f((t=>k(t)||0==t.length),"nullOrEmpty");function T(t){const e="data:image/svg+xml;base64,";t.startsWith(e)&&(t=t.slice(e.length));const n=N(t),r=new Array(n.length);for(let o=0;o<n.length;o++)r[o]=n.charCodeAt(o);const a=new Uint8Array(r);return new TextDecoder("utf-8").decode(a)}function N(t){if("undefined"!==typeof u)return u.from(t,"base64").toString("binary");if("function"===typeof window.atob)return window.atob(t);throw new Error("Base64 decoding not supported in this environment")}function L(t){const e="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<t;r++){const t=Math.floor(Math.random()*e.length);n+=e.charAt(t)}return n}function R(t,e){const n=e.match(/^data:(.+);base64,(.+)$/);if(!n)throw new Error(e.substring(0,e.length>10?9:e.length-1));const r=n[1],a=u.from(n[2],"base64");{const e="".concat(V(t),".").concat(r.split("/")[1]);return new File([a],e,{type:r})}}function A(t,e,n){return e.reduce(((e,r)=>{var a=r[t];return n&&(a=n(a)),void 0!==a&&(e[a]=r),e}),{})}function U(t){const e=Object.entries(t);e.sort(((t,e)=>{let[,n]=t,[,r]=e;const a=(n.index||"").toString(),o=(r.index||"").toString();return a.localeCompare(o)}));const n={};for(const[r,a]of e)n[r]=a;return n}f(T,"base64ToSvg"),f(N,"atobLegacy"),f(L,"genId"),f(R,"base64ToFile"),f(A,"arrayToMap"),f(U,"orderOptions");var W=f((t=>{const e=Object.entries(t);e.sort(((t,e)=>{const n=t[1].name.toUpperCase(),r=e[1].name.toUpperCase();return n<r?-1:n>r?1:0}));const n={};return e.forEach((t=>{let[e,r]=t;n[e]=r})),n}),"orderByName");function O(t,e){return new Promise((async(n,r)=>{try{const r={...t};for(const[n,a]of Object.entries(t))if(a&&B(a)){const t=await e(n,a);t&&Object.assign(r,t)}n(r)}catch(a){r(a)}}))}f((function(t,e){return!(!t||!e)&&(j(t)&&F(t).toLowerCase()===F(e).toLowerCase())}),"isTheSameUrl"),f(O,"expandImagesMap");var j=f((t=>t.startsWith("http")),"isUploadedFileUrl"),B=f((t=>t.startsWith("data:image")||t.startsWith("data:img")),"isImageDataUrl"),H=f(((t,e,n)=>{if(!t)return"";var r=e[t];if(t.includes("."),!r||j(r)||B(r)?r&&(r=e["".concat(t).concat(n||"")],t.includes(".")):(r=e["".concat(e[t]).concat(n||"")],t.includes(".")),!r&&n){const n=t.split("_"),a=n[n.length-1];(isNaN(Number(a.trim()))||Number(a.trim())<512)&&(r=e[t])}return t.includes("."),r}),"getImage");function V(t){return t.trim().replace(/[/\\?%*:|"<>]/g,"").replace(/\s+/g,"-")}function z(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>{const t=y(r.width,r.height),a=t.getContext("2d");if(t.width=r.width,t.height=r.height,!a)return n(new Error("No canvas context"));a.fillRect(0,0,t.width,t.height),a.drawImage(r,0,0);const o=t.toDataURL("image/jpeg",.8);e(o)},r.onerror=n,r.src=t}))}function Y(t){return new Promise(((t,e)=>{e(new Error(""))}))}f(V,"cleanFilename"),f((async function(t){const e={};for(const[n,r]of Object.entries(t))if(r.startsWith("data:image/png")||r.startsWith("data:img/png")){const t=await z(r);e[n]=t}else e[n]=r;return e}),"convertPngBase64ImagesToJpeg"),f((async function(t){const e={};for(const[n,r]of Object.entries(t))if(r.startsWith("data:image/png")||r.startsWith("data:img/png")){const t=await Y(r);e[n]=t}else e[n]=r;return e}),"convertPngBase64ImagesWithUPNG"),f(z,"convertPngToJpg"),f(Y,"convertPngWithUPNG");var G=f(((t,e)=>{if(!e)return e;var n=e.substring("".concat(t," ").length);if(isNaN(Number(n)))return"".concat(n,", ").concat(t);switch(n.substring(n.length-1)){case"1":return"".concat(n,"st ").concat(t);case"2":return"".concat(n,"nd ").concat(t);case"3":return"".concat(n,"rd ").concat(t);default:return"".concat(n,"th ").concat(t)}}),"buildImageSelectName"),Q=f(((t,e,n)=>{const r=null===t||void 0===t?void 0:t.visibility_code;if(r&&r.length>0&&(r.includes("==")||r.includes("!="))){let t,a=r.split("==");r.includes("==")?(a=r.split("=="),t=!1):(a=r.split("!="),t=!0);const o=a[0].trim(),i=a[1].trim(),l=f((t=>P(o,n,X,t)),"parseCodeResult"),s=[l(((t,n)=>{var r,a,o,i;return"text_select"===(null===(r=e[t])||void 0===r?void 0:r.type)&&(null===(a=e[t])||void 0===a||null===(o=a.selections)||void 0===o?void 0:o[n])?((null===(i=e[t].selections[n])||void 0===i?void 0:i.name)||"").trim():n})),l(((t,n)=>{var r,a,o,i,l;if("text_select"===(null===(r=e[t])||void 0===r?void 0:r.type)&&(null===(a=e[t])||void 0===a||null===(o=a.selections)||void 0===o?void 0:o[n]))return((null===(l=e[t].selections[n])||void 0===l?void 0:l.value)||"").trim();if("image_select"===(null===(i=e[t])||void 0===i?void 0:i.type)){var s,c;return(null===(s=((null===(c=e[t])||void 0===c?void 0:c.options)||{})[n])||void 0===s?void 0:s.name)||""}return n})),l(((t,n)=>{var r;if("image_select"===(null===(r=e[t])||void 0===r?void 0:r.type)){var a,o;return G(e[t].name,(null===(a=((null===(o=e[t])||void 0===o?void 0:o.options)||{})[n])||void 0===a?void 0:a.name)||"")}return n}))],c=f((t=>{const e=t.split(/\s*(\|\||&&)\s*/);t.includes("5th");let n=d(e[0]);for(let r=2;r<e.length;r++){const t=d(e[r]),a=e[r-1];"||"===a?n=n||t:"&&"===a&&(n=n&&t)}return n}),"evaluateExpression"),d=f((e=>{const n=e.trim();return t?s.some((t=>t.toLowerCase()!==n.toLowerCase())):s.some((t=>t.toLowerCase()===n.toLowerCase()))}),"checkOperand");return c(i)}return!0}),"showField"),Z=f((t=>{const[e,n]=t.split(".",2);if(!n)return{name:e};const[r,a]=[n.split("_")[0],n.split("_").slice(1).join(" ")];return{name:e,type:r,selectIndex:a,typeAndSelectIndex:n}}),"splitSvgElementId"),X=f((t=>{const{type:e}=Z(t);return!(!e||!["text","textarea"].includes(e))}),"useDataForRandSeed"),J=f(((t,e,n,r)=>{var a;return r&&n&&["gen","date"].includes(null===(a=r[t])||void 0===a?void 0:a.type)&&(e=P(r[t].code,n,X,((t,e)=>{var n,a;return"text_select"==(null===(n=r[t])||void 0===n?void 0:n.type)?((null===(a=(r[t].selections||{})[e])||void 0===a?void 0:a.value)||"").trim():e}))),e}),"valueOfParseValue"),$=f(((t,e,n)=>"/".concat(t,"/").concat(e,"/").concat(n).toLowerCase()),"fileFieldStorageKey"),q=f((()=>!0),"isBrowser"),K=f(((t,e,n,r)=>{if(!q()||!(null===window||void 0===window?void 0:window.localStorage)){const{type:t,name:e}=Z(n);return t&&r?"upload"==t&&e.toLowerCase().split(" ").includes("logo")?r.logo:r["".concat(t)]:null}return null===window||void 0===window?void 0:window.localStorage.getItem($(t,e,n))}),"getFileFieldFile"),tt=f(((t,e)=>{if(!t)return t;if(t.startsWith("/"))return"https://".concat(e).concat(t);try{const n=new URL(t);return n.host=e,n.protocol="https:",n.toString()}catch(n){return console.error("Invalid URL:",t),t}}),"setR2Host"),et=f(((t,e,n)=>{const r=Math.max(e,n);return t>r&&Math.abs(t-r)>=16&&Math.abs(e-n)<=1}),"isValidPixel");function nt(t){return new Promise((e=>{const n=new Image;n.onload=()=>{const t=n.realImage?n.realImage:n;e(t)},n.src=t}))}function rt(t){return t.toDataURL()}function at(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;const a=y(t.width,t.height),o=a.getContext("2d");if(o){o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high";var i=e,l=e/(t.naturalWidth/t.naturalHeight);if(a.width=e,a.height=n,n>l){const e=100*(n-l)/n,a=Math.min(r,e),s=a/100*t.naturalWidth,c=s/2;l+=a/100*l,o.drawImage(t,c,0,t.naturalWidth-s,t.naturalHeight,0,n-l,i,l)}else o.drawImage(t,0,0,t.width,t.height,0,0,i,l)}return a}function ot(t,e,n){const{x:r,y:a}=t,{x:o,y:i}=e,{x:l,y:s}=n;function c(t,e){return Math.atan2(e-a,t-r)}function d(t){return t*(180/Math.PI)}f(c,"getAngle"),f(d,"radiansToDegrees");const h=c(o,i);let u=c(l,s)-h;u<0&&(u+=2*Math.PI);const g=d(u);return g}function it(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function lt(t,e){return{x:Math.round((t.x+e.x)/2),y:Math.round((t.y+e.y)/2)}}function st(t,e){return new Promise(((n,r)=>{const a=y(t.naturalWidth||t.width,t.naturalHeight||t.height);a.width=t.naturalWidth,a.height=t.naturalHeight;const o=a.getContext("2d");if(!o)return r(new Error("Could not get canvas context"));o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(t,0,0);const i=o.getImageData(0,0,t.width,t.height).data,l=f((e=>{for(let n=0;n<t.width;n++){const r=4*(e*t.width+n);if(0!==i[r+3])return!1}return!0}),"isRowTransparent");let s=0;for(let e=0;e<t.height&&l(e);e++)s++;if(s>=e)return n(t);const c=e-s,d=y(t.width,t.height);d.width=t.width,d.height=t.height;const h=d.getContext("2d");if(!h)return r(new Error("Could not get canvas context"));h.clearRect(0,0,d.width,d.height),h.drawImage(t,0,0,t.width,t.height-c,0,c,t.width,t.height-c),n(d)}))}function ct(t){return new Promise(((e,n)=>{const r=y(t.naturalWidth,t.naturalHeight);r.width=t.naturalWidth,r.height=t.naturalHeight;const a=r.getContext("2d");if(!a)return n(new Error("Could not get canvas context"));a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(t,0,0);const o=a.getImageData(0,0,r.width,r.height),i=o.data,l=[];for(let t=0;t<o.height;t++)for(let e=0;e<o.width;e++){const n=4*(t*o.width+e),r=i[n],a=i[n+1],s=i[n+2];et(s,r,a)&&l.push({x:e,y:t})}if(0===l.length)return e(null);const s={x:1/0,y:1/0},c={x:-1/0,y:1/0},d={x:1/0,y:-1/0},h={x:-1/0,y:-1/0};l.forEach((t=>{t.x+t.y<s.x+s.y&&(s.x=t.x,s.y=t.y),t.x-t.y>c.x-c.y&&(c.x=t.x,c.y=t.y),t.x-t.y<d.x-d.y&&(d.x=t.x,d.y=t.y),t.x+t.y>h.x+h.y&&(h.x=t.x,h.y=t.y)})),e({topLeft:s,topRight:c,bottomRight:h,bottomLeft:d})}))}function dt(t){return new Promise(((e,n)=>{const r=y(t.naturalWidth,t.naturalHeight);r.width=t.naturalWidth,r.height=t.naturalHeight;const a=r.getContext("2d");if(!a)return n(new Error("Could not get canvas context"));a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(t,0,0);const o=a.getImageData(0,0,r.width,r.height).data;let i={x:1/0,y:0},l={x:0,y:1/0},s={x:0,y:0},c={x:0,y:0};for(let t=0;t<r.height;t++)for(let e=0;e<r.width;e++){const n=4*(t*r.width+e),a=o[n],d=o[n+1],h=o[n+2];et(d,a,h)&&(e<i.x&&(i={x:e,y:t}),e>s.x&&(s={x:e,y:t}),t<l.y&&(l={x:e,y:t}),t>c.y&&(c={x:e,y:t}))}const d=t.height>t.width,h=d?i:l,u=d?s:c;if(!h||!u)return n(new Error("No green line found"));e({startPoint:h,endPoint:u})}))}function ht(t){return new Promise(((e,n)=>{const r=y(t.naturalWidth,t.naturalHeight);r.width=t.naturalWidth,r.height=t.naturalHeight;const a=r.getContext("2d");if(!a)return n(new Error("Could not get canvas context"));a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(t,0,0);const o=a.getImageData(0,0,r.width,r.height).data;let i={x:[],y:[]};for(let t=0;t<r.height;t++)for(let e=0;e<r.width;e++){const n=4*(t*r.width+e),a=o[n],l=o[n+1],s=o[n+2];et(a,l,s)&&(i.x.push(e),i.y.push(t))}if(0==i.x.length)return n(new Error("No red dot found"));e(i)}))}function ut(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=y(t.naturalWidth||t.width,t.naturalHeight||t.height);r.width=t.naturalWidth||t.width,r.height=t.naturalHeight||t.height;const a=r.getContext("2d");if(!a)throw new Error("Could not get canvas context");a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.clearRect(0,0,r.width,r.height);const{topLeft:o,topRight:i,bottomRight:l,bottomLeft:s}=e;return a.beginPath(),a.moveTo(o.x,o.y),a.lineTo(i.x,i.y),a.lineTo(l.x,l.y),a.lineTo(s.x,s.y),a.closePath(),a.save(),a.clip(),a.drawImage(t,0,0),a.restore(),n&&(a.strokeStyle=n,a.lineWidth=2,a.beginPath(),a.moveTo(o.x,o.y),a.lineTo(i.x,i.y),a.lineTo(l.x,l.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke()),r}function gt(t,e,n,r,a,o,i,l,s,c,d){const h=y(l,s),u=h.getContext("2d");if(!u)throw new Error("Could not get canvas context");if(u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",h.width=l,h.height=s,u.translate(l/2,s/2),u.rotate(e*Math.PI/180),u.transform(n,a,o,r,0,0),i){const t=i.x-l/2,e=i.y-s/2;u.translate(t,e)}u.drawImage(t,-t.width/2,-t.height/2);return ut(h,c,null===d||void 0===d?void 0:d.border)}async function ft(t,e){const n=await ct(t);if(!n)throw new Error("Blue border box not found!");const{topLeft:r,topRight:a,bottomLeft:o,bottomRight:i}=n;let l=await ht(t);if(!r||!i)throw new Error("Bounding box corners not found");const s=await dt(t),{startPoint:c,endPoint:d}=s,h=lt(c,d),u={x:l.x[l.x.length-1],y:l.y[l.y.length-1]},g=Math.round(it(u,h)),f={x:u.x,y:u.y+g},m=2*(t.height>t.width?-1:1)+Math.round(ot(u,f,h));let p=parseFloat((it(r,a)/t.naturalWidth).toPrecision(12)),v=parseFloat((it(r,o)/t.naturalHeight).toPrecision(12));p+=.04,v+=.04;return{rotationAngle:m,scaleX:p,scaleY:v,shearX:0,shearY:0,center:u,width:t.width,height:t.height,corners:n}}function mt(t){const e=t%360;return Math.abs(e-90)<=30||Math.abs(e-270)<=30?"landscape":Math.abs(e-0)<=30||Math.abs(e-180)<=30||Math.abs(e-360)<=30?"portrait":"diagonal"}f(nt,"base64ToImage"),f(rt,"imageToBase64"),f(at,"resizeImage"),f(ot,"calculateAngleBetweenPoints"),f(it,"calculateDistance"),f(lt,"calculateMidpoint"),f(st,"ensureTopSpace"),f(ct,"findBlueQuadrilateralCorners"),f(dt,"detectGreenLine"),f(ht,"getRedDots"),f(ut,"chipOffImage"),f(gt,"applyTransformation"),f(ft,"analyzeImage"),f(mt,"imageOrientation");var pt=f(((t,e,n,r)=>{const a=mt(r);return"portrait"==a||"diagonal"==a?at(t,e,n):at(t,n,e)}),"alignedImageSize");async function vt(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3?arguments[3]:void 0,a=await nt(e);const{rotationAngle:o,scaleX:i,scaleY:l,shearX:s,shearY:c,center:d,width:h,height:u,corners:g}=t,f=h,m=u;a.width===f&&a.height===m||(a=pt(a,f,m,o));const p=Math.round(n*a.height/100);a=await st(a,p);const v=gt(a,o-360,i,l,s,c,d,f,m,g,r);return rt(v)}f(vt,"transformImageByTemplate");var wt=f(((t,e,n)=>new Promise(((r,a)=>{const o=new Image;o.onload=()=>{const t=y(o.width,o.width),i=t.getContext("2d");if(!i)return a(new Error("Canvas not supported"));t.width=o.width,t.height=o.height;const l=o.realImage?o.realImage:o;i.drawImage(l,0,0);const s=i.getImageData(0,0,t.width,t.height);e(s,n),i.putImageData(s,0,0),r(t.toDataURL())},o.src=t,o.onerror=a}))),"applyFilter"),yt=["0.1","0.2","0.3","0.4","0.5","0.6","0.7"],bt={Whitescale:{id:"Whitescale",filter:f((t=>wt(t,(t=>{const e=t.data;for(let n=0;n<e.length;n+=4)e[n]=255,e[n+1]=255,e[n+2]=255}))),"filter")},Blackscale:{id:"Blackscale",filter:f((t=>wt(t,(t=>{const e=t.data;for(let n=0;n<e.length;n+=4)e[n]=0,e[n+1]=0,e[n+2]=0}))),"filter")},Greyscale:{id:"Greyscale",filter:f((t=>wt(t,(t=>{const e=t.data;for(let n=0;n<e.length;n+=4){const t=(e[n]+e[n+1]+e[n+2])/3;e[n]=t,e[n+1]=t,e[n+2]=t}}))),"filter")},Redscale:{id:"Redscale",filter:f((t=>wt(t,(t=>{const e=t.data;for(let n=0;n<e.length;n+=4)e[n+1]=0,e[n+2]=0}))),"filter")},Greenscale:{id:"Greenscale",filter:f((t=>wt(t,(t=>{const e=t.data;for(let n=0;n<e.length;n+=4)e[n]=0,e[n+2]=0}))),"filter")},Bluescale:{id:"Bluescale",filter:f((t=>wt(t,(t=>{const e=t.data;for(let n=0;n<e.length;n+=4)e[n]=0,e[n+1]=0}))),"filter")},Sepia:{id:"Sepia",filter:f(((t,e)=>wt(t,(t=>{var n;const r=null!==(n=null===e||void 0===e?void 0:e.rMult)&&void 0!==n?n:.393;var a;const o=null!==(a=null===e||void 0===e?void 0:e.gMult)&&void 0!==a?a:.769;var i;const l=null!==(i=null===e||void 0===e?void 0:e.bMult)&&void 0!==i?i:.189;var s;const c=null!==(s=null===e||void 0===e?void 0:e.rAdd)&&void 0!==s?s:.349;var d;const h=null!==(d=null===e||void 0===e?void 0:e.gAdd)&&void 0!==d?d:.686;var u;const g=null!==(u=null===e||void 0===e?void 0:e.bAdd)&&void 0!==u?u:.272,f=t.data;for(let e=0;e<f.length;e+=4){const t=f[e],n=f[e+1],a=f[e+2],i=r*t+o*n+l*a,s=c*t+h*n+g*a,d=g*t+g*n+g*a;f[e]=i>255?255:i,f[e+1]=s>255?255:s,f[e+2]=d>255?255:d}}))),"filter")},Guassianblur:{id:"Guassianblur",filter:f(((t,e)=>wt(t,((t,e)=>{const n=Number(yt[0]),r=Number(yt[yt.length-1]);var a=(null===e||void 0===e?void 0:e.radius)&&!isNaN(e.radius)?Number(e.radius):n;a>r&&(a=n),a*=10;const o=t.data,i=t.width,l=t.height,s=new Uint8ClampedArray(o);function c(){for(let t=0;t<l;t++)for(let e=0;e<i;e++){let n=0,r=0,l=0,c=0,d=0;for(let o=-a;o<=a;o++){const a=e+o;if(a>=0&&a<i){const e=4*(t*i+a);n+=s[e],r+=s[e+1],l+=s[e+2],c+=s[e+3],d++}}const h=4*(t*i+e);o[h]=n/d,o[h+1]=r/d,o[h+2]=l/d,o[h+3]=c/d}}function d(){for(let t=0;t<i;t++)for(let e=0;e<l;e++){let n=0,r=0,c=0,d=0,h=0;for(let o=-a;o<=a;o++){const a=e+o;if(a>=0&&a<l){const e=4*(a*i+t);n+=s[e],r+=s[e+1],c+=s[e+2],d+=s[e+3],h++}}const u=4*(e*i+t);o[u]=n/h,o[u+1]=r/h,o[u+2]=c/h,o[u+3]=d/h}}f(c,"blurHorizontal"),f(d,"blurVertical"),c(),d()}),e)),"filter")},ImageTransform:{id:"ImageTransform",filter:f(((t,e)=>vt(e,t,2)),"filter")}},xt=f(((t,e,n,r)=>{if(r<=n)return{scaleH:t,scaleV:e};const a=n/r;return{scaleH:t*a,scaleV:e*a}}),"scaleDownFont");function It(t,e,n,r,a){return t.replace(/(translate|rotate|scale|matrix|skewX|skewY)\(([^)]+)\)/g,((t,o,i)=>{let l=i.split(/[ ,]+/).map(Number);if("translate"===o)l[0]=e(l[0]),l[1]=n(l[1]);else if("scale"===o){if(l[0]=l[0],l.length>1?l[1]=l[1]:l[1]=l[0],a){const{scaleH:t,scaleV:e}=xt(l[0],l[1],a,(r||"").length);[1.499].includes(l[1]),l[0]=t,l[1]=e}}else if("matrix"===o)l[4]=e(l[4]),l[5]=n(l[5]);else{if("rotate"===o)return"".concat(o,"(").concat(i,")");if("skewX"===o)return"".concat(o,"(").concat(e(Number(i.trim())),")");if("skewY"===o)return"".concat(o,"(").concat(n(Number(i.trim())),")")}return"".concat(o,"(").concat(l.join(" "),")")}))}function Ft(t,e,n){return t.replace(/([MLHVCSQTZ])([^MLHVCSQTZ]*)/gi,((t,r,a)=>{let o=a.trim().split(/([, ])/).map((t=>t.trim()));for(let i=0;i<o.length;i++)isNaN(parseFloat(o[i]))||("H"===r.toUpperCase()?o[i]=e(parseFloat(o[i])):"V"===r.toUpperCase()?o[i]=n(parseFloat(o[i])):o[i]=i%2===0?e(parseFloat(o[i])):n(parseFloat(o[i])));return"".concat(r).concat(o.join(""))}))}function St(t,e,n){let r=t.trim().split(" ").map((t=>parseFloat(t)));if(4!==r.length)throw new Error("Invalid viewBox format. Expected format: 'min-x min-y width height'");return r[0]=e(r[0]),r[1]=n(r[1]),r[2]=e(r[2]),r[3]=n(r[3]),r.join(" ")}function Mt(t,e,n,r,a){const o=r/e,i=a/n,l=Math.min(o,i),s=t.match(/^(\d+(\.\d+)?)([a-z%]*)$/i);if(!s)throw new Error("Invalid font size format");const c=parseFloat(s[1]),d=s[3]||"";return"".concat(c*l).concat(d)}f(It,"responsiveTransform"),f(Ft,"responsivePathD"),f(St,"responsiveViewBox"),f(Mt,"responsiveFontSize");var _t=f(((t,e,n,r)=>0==t?0:(t=t*e/n,r?parseFloat(t.toFixed(r)):Math.ceil(t))),"getResponsiveX"),Ct=f(((t,e,n,r)=>0==t?0:(t=t*e/n,r?parseFloat(t.toFixed(r)):Math.ceil(t))),"getResponsiveY");function Et(t,e){if(e<0||e>100)throw new Error("Percentage should be between 0 and 100");const n=t.length,r=[];for(let i=0;i<n;i++)" "!==t[i]&&r.push(i);const a=Math.round(e/100*r.length);for(let i=r.length-1;i>0;i--){const t=Math.floor(Math.random()*(i+1));[r[i],r[t]]=[r[t],r[i]]}const o=new Set(r.slice(0,a));return t.split("").map(((t,e)=>" "===t||o.has(e)?t:"*")).join("")}async function Pt(t,e,n){function r(t){const e=(new DOMParser).parseFromString(t,"image/svg+xml"),n=Array.from(e.querySelectorAll("style")).map((t=>t.textContent||"")).join(" ");function r(t){const e=new RegExp("".concat(t,"\\s*{[^}]*fill:\\s*([^;]+);"),"gi"),r=Array.from(n.matchAll(e)),a=r.length>0?r[r.length-1][1].trim():null;return console.log("findFillInCSS:",t,a),a}console.log("styleContent:",n),f(r,"findFillInCSS");const a=e.querySelectorAll("text"),o={};return a.forEach((t=>{let e=t.getAttribute("fill");if(!e){var n;const a=(null===(n=t.getAttribute("class"))||void 0===n?void 0:n.split(/\s+/))||[],o=t.getAttribute("id");for(const t of a)e||(e=r("\\.".concat(t)));!e&&o&&(e=r("#".concat(o)))}e&&(e=e.toLowerCase(),o[e]=(o[e]||0)+1)})),Object.entries(o).sort(((t,e)=>e[1]-t[1])).map((t=>{let[e]=t;return e}))[0]||"black"}return f(r,"getDominantTextColor"),new Promise(((a,o)=>{const i=r(t),l=new Image;let s;try{s=btoa(unescape(encodeURIComponent(t)))}catch(c){return console.log("getDominantTextColor:error",null===c||void 0===c?void 0:c.message,t),o(c)}l.onload=()=>{var t;const r=y(e,n);r.width=e,r.height=n;const o=r.getContext("2d");if(!o)return void a("");o.clearRect(0,0,e,n),o.font="20px Arial",o.globalAlpha=.9;const l="Fake Sample",s=o.measureText(l).width,c=Math.floor(e*n/(20*s*3));for(let a=0;a<c;a++){const t=Math.random()*e,r=Math.random()*n,a=(60*Math.random()-30)*(Math.PI/180);o.save(),o.translate(t,r),o.rotate(a),o.fillStyle=i,o.fillText(l,0,0),o.restore()}const d='Remove watermark to remove "Fake Sample" and show all hidden texts.';let h=Math.floor(e/30);var u;o.font="".concat(h,"px Arial"),o.globalAlpha=1;const g=null!==(u=null===(t=i.match(/\d+/g))||void 0===t?void 0:t.map(Number))&&void 0!==u?u:[0,0,0],f=.299*g[0]+.587*g[1]+.114*g[2];o.fillStyle=f>128?"black":"white";let m=o.measureText(d).width;const p=.45*e;for(;m>p&&h>10;)h-=2,o.font="".concat(h,"px Arial"),m=o.measureText(d).width;const v=.8*h,w=.05*e;[{x:w,y:.15*n},{x:w,y:.6*n}].forEach((t=>{let{x:e,y:n}=t;const r=m+2*v,a=h+1.5*v,i=e-.5*v,l=n-h-v;o.globalAlpha=.5,o.fillStyle="black",o.fillRect(i,l,r,a),o.globalAlpha=1,o.fillStyle="white",o.fillText(d,e,n)})),a(r.toDataURL("image/png"))},l.src="data:image/svg+xml;base64,".concat(s)}))}f(Et,"obscureText"),f(Pt,"watermark");var kt=f(((t,e)=>"".concat(t.replace(/\s/g,"")).concat(e?":".concat(e.replace(/\s/g,"")):"")),"getIdentifier");function Dt(t){const e=t.match(/^([-+]?\d*\.?\d+)([a-zA-Z]+)$/);if(e)return{value:e[1],unit:e[2]};throw new Error("Invalid input format: ".concat(t))}function Tt(t,e){const n={},r=/([^{]+)\{([^}]+)\}/g;let a;for(;null!==(a=r.exec(t));){const t=a[1].trim(),e=a[2].trim().split(";").filter(Boolean).map((t=>{const[e,n]=t.split(":").map((t=>t.trim()));return{property:e,value:n}}));n[t]=e}Object.keys(n).forEach((t=>{const r=n[t],a=e(t,r);n[t]=a}));let o="";return Object.keys(n).forEach((t=>{const e=n[t].map((t=>{let{property:e,value:n}=t;return"".concat(e,": ").concat(n,";")})).join(" ");o+="".concat(t," { ").concat(e," }\n")})),o}function Nt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return t.attributes&&t.attributes["font-family"]&&e.add(t.attributes["font-family"]),"defs"===t.name&&t.children&&t.children.forEach((t=>{if("style"===t.name&&t.children&&t.children.length>0){Lt(t.children[0].value,e)}})),t.children&&t.children.length>0&&t.children.forEach((t=>Nt(t,e))),e}function Lt(t,e){const n=/font-family:\s*([^;]+);/g;let r;for(;null!==(r=n.exec(t));)e.add(r[1].trim())}async function Rt(t){const e=Nt(await(0,s.parse)(t));return Array.from(e)}async function At(t){try{const e=await c.Z.get(t,{responseType:"arraybuffer"}),n=u.from(e.data),r=e.headers["content-type"]||"application/octet-stream",a=n.toString("base64");return"data:".concat(r,";base64,").concat(a)}catch(e){throw new Error("Failed to fetch font data from ".concat(t,": ").concat(e.message))}}function Ut(t){let e=t.toLowerCase();return e=e.replace(/["']/g,""),e=e.replace(/[\s]+/g,"-"),e=e.replace(/[^a-z0-9-]+/g,""),e=e.replace(/-+/g,"-"),e=e.replace(/^-|-$/g,""),e}function Wt(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["ttf","otf","woff","woff2","eot","svg"];return new Promise((async(r,a)=>{const o={};for(const l of e){const e={name:l.replace(/["']/g,""),id:Ut(l)};let r=!1;for(const a of n){const n="https://".concat(t,"/fonts/").concat(V(e.id),".").concat(a,"?v=1");try{const t=await At(n);e.url=n,e.dataUrl=t,e.ext=a,r=!0;break}catch(i){e.readError=i.message}}r||(e.readError="No valid font found for ".concat(l," with extensions: ").concat(n.join(", "))),o[e.id]=e}r(o)}))}function Ot(t){return{ttf:"truetype",otf:"opentype",woff:"woff",woff2:"woff2",eot:"embedded-opentype",svg:"svg"}[t.toLowerCase()]||"unknown"}f(Dt,"parseValueUnit"),f(Tt,"parseAndModifyCSS"),f(Nt,"collectFontFamilies"),f(Lt,"extractFontFamiliesFromCSS"),f(Rt,"getFontFamiliesFromSVG"),f(At,"fetchFontDataAsDataUrl"),f(Ut,"getFontId"),f(Wt,"generateFontMap"),f(Ot,"getFontFormat"),f((function(t,e){return{ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2",eot:"font/eot",svg:"svg"}[e.toLowerCase()]?new Promise(((e,n)=>{if(!q()||!(null===document||void 0===document?void 0:document.fonts))return e("");new FontFace("CustomFont","url(".concat(t,")")).load().then((t=>{document.fonts.add(t);const n=y(100,100);n.width=100,n.height=100;const r=n.getContext("2d");if(!r)return;r.clearRect(0,0,n.width,n.height),r.fillStyle="#FFFFFF",r.fillRect(0,0,n.width,n.height),r.fillStyle="#000000",r.font="50px CustomFont",r.textAlign="center",r.textBaseline="middle",r.fillText("Aa",n.width/2,n.height/2);const a=n.toDataURL("image/png");e(a)})).catch((t=>{n(t)}))})):Promise.reject(new Error("Unsupported font format"))}),"createFontThumbnail");var jt=f((async(t,e,n,r)=>{const a=await v(t),o=new d.ZP({unit:"px",format:[a.width,a.height]});o.addImage(t,"PNG",0,0,a.width,a.height),o.save(e),n(t)}),"pngToPdf"),Bt=f(((t,e)=>{try{return parseFloat(t.getAttribute(e)||"0")}catch(n){return 0}}),"getNodeImageDimensionAttr");async function Ht(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"png";return new Promise(((r,a)=>{const o=new Image;o.onload=()=>{const i=y(o.width,o.height),l=i.getContext("2d");if(!l)return a("Canvas context not supported");let s=0,c=0,d=o.width,h=o.height;switch(e){case"front":d=o.width/2;break;case"back":s=o.width/2,d=o.width/2;break;case"front_hr":h=o.height/2;break;case"back_hr":c=o.height/2,h=o.height/2;break;default:return r(t)}i.width=d,i.height=h;const u=o.realImage?o.realImage:o;l.drawImage(u,s,c,d,h,0,0,d,h),r(i.toDataURL("image/".concat("pdf"===n?"png":n)))},o.onerror=()=>a("Image loading error"),o.src=t}))}f(Ht,"processBase64Image");var Vt=f((function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"downloadedImage",r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return new Promise(((o,i)=>{try{let l;{const e=new Blob([t],{type:"image/svg+xml"});l=URL.createObjectURL(e)}const s=new Image;s.onload=async function(){const l=Math.min(1,4096/Math.max(s.width,s.height)),c=y(s.width*l,s.height*l),d=c.getContext("2d");let h=s.width*l,u=s.height*l;c.width=h,c.height=u;const g=f(((t,r)=>{const l=r?"".concat(r.toUpperCase(),"_").concat(n,".").concat(e):"".concat(n,".").concat(e);if("pdf"===e)jt(t,l,o,i);else{if(!a){const e=document.createElement("a");e.href=t,e.download=l,e.click()}o(t)}}),"downloadImage"),m=(new DOMParser).parseFromString(t,"image/svg+xml").getElementsByTagName("image");try{if(d){m.length>0&&await Promise.all(Array.from(m).map((t=>new Promise((async e=>{const n=t.getAttributeNS("http://www.w3.org/1999/xlink","href");if(!n)return e();try{var r,a,o,i,l,s,h,u;const g=await w(n),f=(null===t||void 0===t||null===(r=t.x)||void 0===r||null===(a=r.baseVal)||void 0===a?void 0:a.value)||Bt(t,"x")||0,m=(null===t||void 0===t||null===(o=t.y)||void 0===o||null===(i=o.baseVal)||void 0===i?void 0:i.value)||Bt(t,"y")||0,p=Math.min((null===t||void 0===t||null===(l=t.width)||void 0===l||null===(s=l.baseVal)||void 0===s?void 0:s.value)||Bt(t,"width")||c.width,c.width),v=Math.min((null===t||void 0===t||null===(h=t.height)||void 0===h||null===(u=h.baseVal)||void 0===u?void 0:u.value)||Bt(t,"height")||c.height,c.height);null===d||void 0===d||d.drawImage(g,f,m,p,v),e()}catch(g){e()}})))));const t=s.realImage?s.realImage:s;if(d.drawImage(t,0,0,c.width,c.height),r){p=c.toDataURL("image/png");p=await Ht(p,r,e)}else var p=c.toDataURL("image/".concat("pdf"===e?"png":e));g(p,r)}else i(new Error("Unsupported Browser. Please try to download from another browser."))}catch(v){i(v)}},s.onerror=function(){i(new Error("Error loading the SVG."))},s.src=l}catch(l){i(l)}}))}),"downloadSvgAsImage"),zt=f((t=>{try{return h.EK.fromDate(t)}catch(e){return t}}),"dateToTimestamp");f((function(t,e,n){function r(e){if("string"===typeof e||"number"===typeof e)return e;return new Intl.DateTimeFormat("en",e).format(t)}return f(r,"format"),e.map(r).join(n)}),"joinTimeSegments");var Yt=f(((t,e,n,r,a)=>{const o=e?JSON.stringify(e):void 0;let i,l;if(t&&e&&r!=o){n&&(l=n);const r={};for(const n of Object.values(e))if("checkbox"==n.type)r[n.id]=!0;else if("date"==n.type)r[n.id]=zt(new Date);else if("defgen"==n.type&&n.code)t&&(r[n.id]=P(n.code,t,X));else if("image_select"==n.type){var s;if(t&&(null===n||void 0===n?void 0:n.options))r[n.id]=null===(s=Object.values(null===n||void 0===n?void 0:n.options)[0])||void 0===s?void 0:s.id}else if("text_select"==n.type){var c;if(t&&(null===n||void 0===n?void 0:n.selections))r[n.id]=null===(c=Object.values(null===n||void 0===n?void 0:n.selections)[0])||void 0===c?void 0:c.value}else!["image_upload","faceshot","sign"].includes(n.type)&&n.placeholder&&"string"===typeof n.placeholder&&n.placeholder.length>0&&(r[n.id]=n.placeholder);Object.keys(r).length>0&&(i={...r,is_freemium:!0,template_id:n||""})}else a!=n&&(n&&(l=n),i={...t||{},is_freemium:!0,template_id:n||""});return{newFieldString:o,newCurrentTemplateId:l,defaultFieldsData:i}}),"getDefaultFieldsValue");function Gt(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>{e({width:r.width,height:r.height})},r.onerror=t=>{n(new Error("Failed to load image: ".concat(t)))},r.src=t}))}async function Qt(t,e){return new Promise(((n,r)=>{const a=new Image;a.onload=()=>{const t=a.width/a.height,o=e/t,i=document.createElement("canvas");i.width=e,i.height=o;const l=i.getContext("2d");if(l){const t=a.realImage?a.realImage:a;l.drawImage(t,0,0,e,o);const r=i.toDataURL("image/png");n(r)}else r(new Error("Failed to get canvas context"))},a.onerror=t=>{r(new Error("Failed to load image: ".concat(t)))},a.src=t}))}f(Gt,"getImageDimensions"),f(Qt,"resizeBase64Image");var Zt=f((t=>{const[e,n]=t.split(".");return"".concat(e,".").concat((n||"").split("_")[0].trim()).trim()}),"getFieldId"),Xt=f((async(t,e,n)=>{const r=!e[0]||n&&n.includes(e[0].filter_id)?t:await bt[e[0].filter_id].filter(t,e[0].args);return e.shift(),0==e.length?r:Xt(r,e,n)}),"applyFiltersRecursively"),Jt=f(((t,e,n)=>new Promise((async(r,a)=>{try{r(await Xt(t,e,n))}catch(o){a(o)}}))),"applyFilters"),$t=f((async function(t,e,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,i=arguments.length>6?arguments[6]:void 0;const l=Object.entries(e),s={};let c=l;for(let d=1;d<=o&&c.length>0;d++){console.log("\ud83c\udf00 Attempt ".concat(d," - ").concat(c.length," image(s) remaining"));const o=[],l=c.map((async l=>{let[c,h]=l;try{var u;const o=Zt(c);let l=null;if(["image_upload","faceshot","sign"].includes(null===(u=r.fields[o])||void 0===u?void 0:u.type)){l=n[o]&&B(n[o])?n[o]:K("other_tools_data",n.id,o,i)}else if(!c.endsWith("_thumbnail")){const n=H(c,e,a?"_".concat(a):null);n&&(l=await b(t,n))}if(l&&B(l)&&l.startsWith("data:img/")&&(l="data:image/".concat(l.substring("data:img/".length))),l&&B(l)&&r.masks){var g;const t="image_select"===(null===(g=r.fields[o])||void 0===g?void 0:g.type)?o:c,e=r.masks[t];if(e){var f;const t=Object.values(e);l=["sign","image_upload"].includes(null===(f=r.fields[o])||void 0===f?void 0:f.type)?await Jt(l,t,["ImageTransform"]):await Jt(l,t)}}return void(s[c]=l||"")}catch(m){console.warn('\u26a0\ufe0f Failed to fetch image for "'.concat(c,'" on attempt ').concat(d,":"),m.message),o.push([c,h])}}));await Promise.all(l),c=o}if(c.length>0)throw new Error("\u274c Failed to fetch ".concat(c.length," image(s) after ").concat(o," attempts."));return s}),"imagesToBase64");function qt(t,e,n,r,a){const o=e+r/2,i=n+a/2;return"rotate(".concat(t," ").concat(o," ").concat(i,")")}f(qt,"rotateTransformValue");var Kt=f(((t,e,n,r,a,o,i)=>{if(t.attributes.width&&(t.attributes.width="".concat(_t(Number(t.attributes.width),e,r,3))),t.attributes.height&&(t.attributes.height="".concat(Ct(Number(t.attributes.height),n,a,3))),t.attributes.x&&(t.attributes.x="".concat(_t(Number(t.attributes.x),e,r,3))),t.attributes.y&&(t.attributes.y="".concat(Ct(Number(t.attributes.y),n,a,3))),t.attributes.transform&&(t.attributes.transform=It(t.attributes.transform,(t=>_t(t,e,r,3)),(t=>Ct(t,n,a,3)),o,i)),"path"==t.name&&t.attributes.d&&(t.attributes.d=Ft(t.attributes.d,(t=>_t(t,e,r,3)),(t=>Ct(t,n,a,3)))),t.attributes.dy&&(t.attributes.dy="".concat(Ct(Number(t.attributes.dy),n,a,3))),t.children.length>0)for(var l=0;l<t.children.length;l++)Kt(t.children[l],e,n,r,a,o,i)}),"scaleSvg"),te=f(((t,e,n,r,a)=>{let o=0;const i=e?e.split("\n"):[],l=i.length,s=[],c=f(((t,e)=>{const n=[];let r="";for(const a of t.split(" "))(r+a).length>e?(r.length>0&&n.push(r.trim()),r=a+" "):r+=a+" ";return r.trim().length>0&&n.push(r.trim()),n}),"breakLineSafely");for(let d=0;d<t.children.length;d++){if(t.children[d].value.length>0)if(o++,s.push(t.children[d].value),i.length>0){let e=i[0];if(r&&e.length>r){const t=c(e,r);e=t.shift()||"",i[0]=t.join("\n")}else i.shift();t.children[d].value=a?Et(e,70):e}else l>0&&(t.children[d].value="");if(t.children[d].children.length>0)for(let e=0;e<t.children[d].children.length;e++)if(t.children[d].children[e].value.length>0)if(o++,s.push(t.children[d].children[e].value),i.length>0){let n=i[0];if(r&&n.length>r){const t=c(n,r);n=t.shift()||"",i[0]=t.join("\n")}else i.shift();t.children[d].children[e].value=a?Et(n,70):n}else l>0&&(t.children[d].children[e].value="")}return{maxLines:o,defaultInputLines:s}}),"getTextAreaMaxLength"),ee=f(((t,e,n,r,a,o,i,l,s,c,d,h)=>{if(!Q(a,t,i))return void(e.children[r].attributes.class="hide");if("image"==e.children[r].name&&!(null===a||void 0===a?void 0:a.type)){const t=H(n,o,c?"_".concat(c):null);e.children[r].attributes["xlink:href"]=t}if("defs"!=e.children[r].name&&(e.children[r].attributes["data-svg-id"]=e.children[r].attributes.id),"image_select"==(null===a||void 0===a?void 0:a.type)){if(i[a.id]){const t=i[a.id],n=H(t,o,c?"_".concat(c):null);e.children[r].attributes["xlink:href"]=n}}else if(["image_upload","sign","faceshot"].includes(null===a||void 0===a?void 0:a.type))o[n]&&(e.children[r].attributes["xlink:href"]=o[n],"sign"==(null===a||void 0===a?void 0:a.type)||null===a||void 0===a||a.type);else if("checkbox"==(null===a||void 0===a?void 0:a.type))o[n]&&i[a.id]&&"image"==e.children[r].name&&(e.children[r].attributes["xlink:href"]=H(n,o,c?"_".concat(c):null));else if("qrcode"==(null===a||void 0===a?void 0:a.type))o[n]&&"image"==e.children[r].name&&(e.children[r].attributes["xlink:href"]=H(n,o,c?"_".concat(c):null));else if(["text","defgen"].includes(null===a||void 0===a?void 0:a.type)){for(var u=e.children[r].children[0];u.children&&u.children.length>0;)u,u=u.children[0];i[a.id]&&(u.value=d?Et(i[a.id],70):i[a.id])}else if(["textarea"].includes(null===a||void 0===a?void 0:a.type))te(e.children[r],i[a.id],a.id,null===a||void 0===a?void 0:a.maxCharsPerLine,d);else if(["gen","date"].includes(null===a||void 0===a?void 0:a.type)){for(u=e.children[r].children[0];u.children&&u.children.length>0;)u,u=u.children[0];u.value=P(a.code,i,X,((e,n)=>{var r,a;return"text_select"==(null===(r=t[e])||void 0===r?void 0:r.type)?((null===(a=(t[e].selections||{})[n])||void 0===a?void 0:a.value)||"").trim():n}))}else if(["text_select"].includes(null===a||void 0===a?void 0:a.type)){var g;for(u=e.children[r].children[0];u.children&&u.children.length>0;)u,u=u.children[0];if(i[a.id])u.value=((null===(g=(a.selections||{})[i[a.id]])||void 0===g?void 0:g.value)||"").trim()}}),"mutateParsedSvg"),ne={"letter-spacing":f((t=>{const{value:e,unit:n}=Dt(t);let r;return r="psd"==n?"".concat(parseFloat(e)/1e3,"em"):t,r}),"letter-spacing")},re=f((t=>{const e={...t};for(const[r,a]of Object.entries(t)){const t=[...a.declarations];for(var n=0;n<t.length;n++){const e=ne[a.declarations[n].property];e&&(t[n]={...t[n],value:e(a.declarations[n].value)})}e[r].declarations=t}return e}),"updateCustomCssValues"),ae=f((t=>{if(!t)return null;const e={...t};return e.if_selector&&(e.if_selector=re(e.if_selector)),e.if_property&&(e.if_property=re(e.if_property)),e.if_property_and_value&&(e.if_property_and_value=re(e.if_property_and_value)),e}),"updateCustomCssPropertiesValuesToCssValues");function oe(t,e,n){const r=Number(t.x),a=r+Number(t.width),o=Number(t.y),i=o+Number(t.height);var l=Number(e.x),s=l+Number(e.width),c=Number(e.y),d=c+Number(e.height);return l+5*l/100>=r&&s-5*s/100<=a&&c+5*c/100>=o&&d-5*d/100<=i?e.id:null}f(oe,"getOcclusionId");var ie=f(((t,e,n)=>{const r=[t.attributes.id];for(var a=n.length-1;a>=0;a--)if(e!=a&&"image"==n[a].name&&n[a].attributes){const e=oe(t.attributes,n[a].attributes,"".concat(t.attributes.id,":").concat(n[a].attributes.id));e&&r.push(e)}return r}),"calculateElementId"),le=f(((t,e,n,r,a,o,i,l)=>new Promise((async(c,d)=>{(0,s.parse)(n.svg).then((async h=>{const u=Object.keys(n.fields),g=Number("".concat(h.attributes.width||0)),f=Number("".concat(h.attributes.height||0));var m=o&&"max"!=o?o:g;const p=m/g*f;let v=await $t(t,n.images,e,n,m,5,l),w=0,y=0,b=0,x=0;var I=-1;h.attributes.width="".concat(m),h.attributes.height="".concat(p),h.attributes.viewBox&&(h.attributes.viewBox=St(h.attributes.viewBox,(t=>_t(t,m,g,3)),(t=>Ct(t,p,f,3))));for(var F=h.children.length-1;F>=0;F--){const t=h.children[F],{name:r,type:o,selectIndex:l,typeAndSelectIndex:s}=Z(t.attributes.id),c="".concat(r,".").concat(o),d=n.fields[c];if(t.attributes.id,Kt(t,m,p,g,f,e[(null===d||void 0===d?void 0:d.id)||""],null===d||void 0===d?void 0:d.maxTextBeforeScaleDown),"defs"==t.name)I=F;else if(u.includes(c)||"image"==t.name){var S=Zt(t.attributes.id);const r="image_select"==o?S:t.attributes.id;ee(n.fields,h,t.attributes.id,F,n.fields[c],v,e,g,f,m,a,(i||{})[r]||((null===n||void 0===n?void 0:n.masks)||{})[r]),((i||{})[r]||{}).ImageTransform&&(w=parseFloat(t.attributes.width),y=parseFloat(t.attributes.height),b=parseFloat(t.attributes.x),x=parseFloat(t.attributes.y))}}var M=[];for(F=h.children.length-1;F>=0;F--){const t=h.children[F];if("image"==t.name){const e=ie(t,F,h.children).filter((t=>!M.includes(t)));M=M.concat(e),h.children[F].attributes["data-click-element-id"]=0==e.length?h.children[F].attributes.id:e.join()}}if(I>-1){const t=h.children[I];t.children&&t.children.forEach((t=>{if("style"===t.name&&t.children&&t.children.length>0){const e=Tt(t.children[0].value,((t,e)=>{const r=ae(n.cssActions),a=(null===r||void 0===r?void 0:r.if_selector)||{},o=(null===r||void 0===r?void 0:r.if_property)||{},i=(null===r||void 0===r?void 0:r.if_property_and_value)||{};var l=[...e];const s=a["*"],c=a[kt(t)];s&&(l=s.shouldReplace?s.declarations:[...l,...s.declarations]),c&&(l=c.shouldReplace?c.declarations:[...l,...c.declarations]);for(var d=0;d<e.length;d++){const t=e[d],n=o["*"],r=o[kt(t.property)],a=i["*"],s=i[kt(t.property,t.value)];n&&(l=n.shouldReplace?n.declarations:[...l,...n.declarations]),r&&(l=r.shouldReplace?r.declarations:[...l,...r.declarations]),a&&(l=a.shouldReplace?a.declarations:[...l,...a.declarations]),s&&(l=s.shouldReplace?s.declarations:[...l,...s.declarations]),"font-size"===t.property&&l.push({property:"font-size",value:Mt(t.value,g,f,m,p)})}return l}));t.children[0].value=e}}));const e=[];if(e.push({name:"style",type:"element",value:"",attributes:{},children:[{name:"",type:"text",value:".hide { opacity: 0 !important;}",attributes:{},children:[]}]}),e.push({name:"style",type:"element",value:"",attributes:{},children:[{name:"",type:"text",value:"#softbaker-slider-handle, #softbaker-button-background, #softbaker-button-text, #softbaker-cancel-background, #softbaker-cancel-text, #softbaker-slider-track { cursor: pointer !important;}",attributes:{},children:[]}]}),h.children[I].children=e.concat(h.children[I].children),r){const t=[];for(const e of Object.values(r))e.dataUrl&&e.ext&&t.push({name:"style",type:"element",value:"",attributes:{},children:[{name:"",type:"text",value:'\n      @font-face {\n        font-family: "'.concat(e.name,'";\n        src: url(').concat(e.dataUrl,") format(").concat(Ot(e.ext),");\n      }"),attributes:{},children:[]}]});t.length>0&&(h.children[I].children=t.concat(h.children[I].children))}}if(i){var _;const t=Object.keys(i)[0],e=((i||{})[t]||{}).ImageTransform,n="#dd6b20",r={name:"rect",type:"element",value:"",attributes:{id:"softbaker-slider-track",x:b+"",y:x+y+10+"",width:w+"",height:"10",fill:"#2a2a2a"},children:[]},a={name:"circle",type:"element",value:"",attributes:{id:"softbaker-slider-handle",cx:b+((null===e||void 0===e||null===(_=e.args)||void 0===_?void 0:_.rotationAngle)||0)*parseFloat(r.attributes.width)/360+"",cy:parseFloat(r.attributes.y)+parseFloat(r.attributes.height)/2+"",r:parseFloat(r.attributes.height)+"",fill:n},children:[]},o={name:"rect",type:"element",value:"",attributes:{id:"softbaker-button-background",x:b+"",y:parseFloat(r.attributes.y)+parseFloat(r.attributes.height)+10+"",width:"40",height:"20",rx:"10",ry:"10",fill:n},children:[]},l={name:"text",type:"element",value:"",attributes:{id:"softbaker-button-text",x:b+parseFloat(o.attributes.width)/2+"",y:parseFloat(o.attributes.y)+parseFloat(o.attributes.height)/2+5+"","font-size":"14","text-anchor":"middle",fill:"#FFFFFF"},children:[{name:"",type:"text",value:"\u2714",parent:null,attributes:{},children:[]}]},s=50,c={name:"rect",type:"element",value:"",attributes:{id:"softbaker-cancel-background",x:b+s+"",y:parseFloat(r.attributes.y)+parseFloat(r.attributes.height)+10+"",width:"40",height:"20",rx:"10",ry:"10",stroke:n},children:[]},d={name:"text",type:"element",value:"",attributes:{id:"softbaker-cancel-text",x:b+s+parseFloat(o.attributes.width)/2+"",y:parseFloat(o.attributes.y)+parseFloat(o.attributes.height)/2+5+"","font-size":"14","text-anchor":"middle",fill:"#FFFFFF"},children:[{name:"",type:"text",value:"\u274c",parent:null,attributes:{},children:[]}]};h.children=h.children.concat([r,a,o,l,c,d])}a?Pt((0,s.stringify)(h),g,f).then((t=>{h.children.push({name:"image",type:"element",value:"",attributes:{id:"watermark-"+L(8),width:g+"",height:f+"","xlink:href":t},children:[]}),c((0,s.stringify)(h))})).catch((t=>{d(t)})):c((0,s.stringify)(h))})).catch((t=>{d(t)}))}))),"getSvg"),se=f((t=>{const[e,n]=t.split("@");return{name:e,directive:n}}),"splitElementNameWithDirective")}}]);