"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{7809:function(e,t,n){n.d(t,{Z:function(){return k}});var i=n(85893),a=n(67294),o=n(57747),r=n(48783),s=n(34292),l=n(93717),c=n(15948),d=n(86201),u=n(75863),p=n(14132),h=n(36238),m=n(55154),f=n(53754),g=n(38118),x=n(94345),v=n(71293),w=n(85461);var b=e=>{let{field:t,images:n,submitButtonText:r,onSettingsUpdated:s}=e;const[l,c]=(0,a.useState)({}),[d,u]=(0,a.useState)({}),[p,f]=(0,a.useState)(null),[g,b]=(0,a.useState)(!1);(0,a.useEffect)((()=>{t&&c(t)}),[t]),(0,a.useEffect)((()=>{console.info("pasrsedSvg:settings",l)}),[l]);const[y,k]=(0,a.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.xu,{onClick:()=>{k(!0)},cursor:"pointer",children:(0,i.jsx)(m.rU2,{size:"1.5rem",color:"#38a169"})}),y?(0,i.jsxs)(x.Z,{title:"".concat(t.name||""," settings"),isOpen:!0,onClose:()=>{k(!1)},dontCloseOnOverlayClick:g,children:[(0,i.jsxs)(o.xu,{height:"50vh",pos:"relative",overflowY:"auto",px:"0.5rem",children:[(0,i.jsx)(v.x,{display:"none",children:t.type}),["image_upload"].includes(t.type)?(0,i.jsx)(h.Z,{w:"100%",id:"upload",title:"File Rule",mb:4,helperText:'Enter the rule of the file. e.g "For best result, upload a 300x300 image."',info:'This is where you enter the rule of the file. e.g "For best result, upload a 300x300 image."',type:h.Z.TYPES.text,value:null===l||void 0===l?void 0:l.ruleMessage,onChange:e=>{e&&c({...l,ruleMessage:e})},errorMessage:d.ruleMessage},"upload"):null,(0,i.jsx)(h.Z,{w:"100%",id:"helper_text",title:"Helper Text",mb:4,helperText:"Enter the text that will show below this field just like this.",info:"This is where you enter the text that will show below this field.",type:h.Z.TYPES.text,value:null===l||void 0===l?void 0:l.helperText,onChange:e=>{e&&c({...l,helperText:e})},errorMessage:d.helperText},"helper_text"),["qrcode","checkbox"].includes(t.type)?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.Z,{w:"100%",id:"info",title:"Info Text",mb:4,helperText:"Enter the text that will show when the user clicks the info icon on this field.",info:"This is where you enter the text that will show when the user clicks the info icon on this field just like this.",type:h.Z.TYPES.text,value:null===l||void 0===l?void 0:l.info,onChange:e=>{e&&c({...l,info:e})},errorMessage:d.info},"info"),(0,i.jsx)(h.Z,{w:"100%",id:"optional",title:"Make Optional",mb:4,helperText:"Enable this if you want this field to be optional.",type:h.Z.TYPES.checkbox,value:null===l||void 0===l?void 0:l.optional,onChange:e=>{e&&c({...l,optional:e})},errorMessage:d.optional},"optional")]})]}),(0,i.jsx)(o.xu,{mb:"1rem",children:(0,i.jsx)(w.Z,{status:"warning",mb:"1rem",onClick:()=>{g||(k(!1),s(l,null))},disabled:g,children:g?"Please wait...":r||"Submit Settings"})})]}):null]})},y=n(8561);var k=e=>{let{created:t,showFieldsErrors:n,fields:x,images:v,masks:w,data:k,isFieldsEditMode:j,isDragable:S,onDragged:_,onFieldDataChange:T,onAllFieldsDataChange:O,fieldDataErrorMessage:C,onSetFieldDataErrorMessage:E}=e;const[I,N]=(0,a.useState)(Object.values(x)),[P,D]=(0,a.useState)(!1);(0,a.useEffect)((()=>{N(Object.values(x));const e={...k};for(const t of Object.values(x))"image_select"==t.type&&t.options&&!e[t.id]&&(e[t.id]=Object.keys(t.options)[0]);Object.keys(e).length>0&&JSON.stringify(e)!=JSON.stringify(k)&&O(e)}),[x,k]);const Z=(e,t)=>(E({...C,[e]:null}),null);return I&&0!=I.length?(0,i.jsx)(o.xu,{as:c.Z5,onDragEnd:e=>{if(!e.destination||!_)return;const t=Array.from(I),[n]=t.splice(e.source.index,1);t.splice(e.destination.index,0,n);const i=t.reduce(((e,t,n)=>(e[t.id]={...t,index:n},e)),{});console.info("parsedSvg:updatedFields",i),_(i)},p:"0px !important",children:(0,i.jsx)(c.bK,{droppableId:"fields",children:e=>(0,i.jsxs)(r.g,{w:"100%",ref:e.innerRef,...e.droppableProps,children:[I.map(((e,t)=>(0,i.jsx)(c._l,{draggableId:e.id,index:t,isDragDisabled:!S,children:t=>{const a=(e=>{const t={key:e.id,id:e.id,title:"".concat(e.name||"").concat(e.optional?"(Optional)":""),helperText:e.helperText||"",info:e.info||"",placeholder:e.placeholder,onChange:t=>{Z(e.id),T(e.id,t)},errorMessage:n?C[e.id]:null,labelEndIcon:j?(0,i.jsx)(b,{field:e,images:v,onSettingsUpdated:(t,n)=>{const i={...x,[e.id]:{...e,...t}},a=n?{...w||{},...n}:null;_&&_(i,a),console.info("pasrsedSvg:settings.updated",i,a)}}):null,message:"Drag and Drop image here",hoverMessage:"Drop the image here",ruleMessage:e.ruleMessage||"Make sure you're uploading an image file.",useImageText:"Use Image"};switch(e.type){case"image_upload":return(0,i.jsx)(d.Z,{width:"100%",...t,thumbnail:k[e.id]?(0,f.VT)("other_tools_data",k.id,e.id):"",onChange:(t,n)=>{n&&(Z(e.id),T(e.id,n))}});case"image_select":var a;const n=Object.values(e.options||{}).map((e=>({id:e.id,title:e.name,thumbnail:(0,y.gJ)(e.id,v,"_thumbnail"),image:{base:(0,y.gJ)(e.id,v,"_512"),md:(0,y.gJ)(e.id,v,"_728"),lg:(0,y.gJ)(e.id,v)}})))||[];return(0,i.jsx)(u.Z,{width:"100%",...t,thumbnail:(0,y.gJ)(k[e.id],v,"_thumbnail"),imageTitle:e.options?null===(a=e.options[k[e.id]])||void 0===a?void 0:a.name:"",onChange:t=>{const n=t;Z(e.id,n.id),T(e.id,n.id)},options:n});case"text":return(0,i.jsx)(h.Z,{width:"100%",...t,value:k[e.id]||"",placeholder:e.name,type:"text"});case"checkbox":case"qrcode":return(0,i.jsx)(h.Z,{...t,value:k[e.id]||"",placeholder:e.name,type:"checkbox"});case"sign":return(0,i.jsx)(p.Z,{width:"100%",...t});default:return null}})(e);return a?(0,i.jsx)("div",{ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,style:{...t.draggableProps.style,width:"100%"},children:(0,i.jsxs)(s.U,{w:"100%",justifyContent:"center",alignItems:e.helperText?"center":"flex-end",mb:4,children:[(0,i.jsx)(o.xu,{width:{base:"100%",md:S?"90%":"100%"},children:a}),(0,i.jsxs)(l.k,{display:{base:"none",md:S?"flex":"none"},w:"40px",h:"40px",border:"1px dashed",pos:"relative",justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(o.xu,{as:m.ZTc,position:"absolute",mb:"25px",size:"10px"}),(0,i.jsx)(o.xu,{as:m.NWQ,position:"absolute",mt:"25px",size:"10px"})]})]})}):(0,i.jsx)("div",{ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,style:{display:"none"}})}},e.id))),e.placeholder]})})}):(0,i.jsx)(g.Z,{message:"Loading template assets...",minH:"100px"})}},4623:function(e,t,n){n.d(t,{Z:function(){return O}});var i=n(85893),a=n(56691),o=n(96918),r=n(34292),s=n(71293),l=n(98303),c=n(57747),d=n(48783),u=n(55154),p=n(67294),h=n(79230),m=n(85431),f=n(94713),g=n(8561),x=n(36238),v=n(94345);const w=(e,t,n)=>new Promise(((i,a)=>{const o=document.createElement("canvas"),r=o.getContext("2d");if(!r)return a(new Error("Canvas not supported"));const s=new Image;s.src=e,s.onload=()=>{o.width=s.width,o.height=s.height,r.drawImage(s,0,0);const e=r.getImageData(0,0,o.width,o.height);t(e,n),r.putImageData(e,0,0),i(o.toDataURL())},s.onerror=a}));var b={Whitescale:{filter:e=>w(e,(e=>{const t=e.data;for(let n=0;n<t.length;n+=4)t[n]=255,t[n+1]=255,t[n+2]=255}))},Blackscale:{filter:e=>w(e,(e=>{const t=e.data;for(let n=0;n<t.length;n+=4)t[n]=0,t[n+1]=0,t[n+2]=0}))},Greyscale:{filter:e=>w(e,(e=>{const t=e.data;for(let n=0;n<t.length;n+=4){const e=(t[n]+t[n+1]+t[n+2])/3;t[n]=e,t[n+1]=e,t[n+2]=e}}))},Redscale:{filter:e=>w(e,(e=>{const t=e.data;for(let n=0;n<t.length;n+=4)t[n+1]=0,t[n+2]=0}))},Greenscale:{filter:e=>w(e,(e=>{const t=e.data;for(let n=0;n<t.length;n+=4)t[n]=0,t[n+2]=0}))},Bluescale:{filter:e=>w(e,(e=>{const t=e.data;for(let n=0;n<t.length;n+=4)t[n]=0,t[n+1]=0}))},Guassianblur:{filter:(e,t)=>w(e,((e,t)=>{const n=(null===t||void 0===t?void 0:t.radius)&&!isNaN(t.radius)?parseFloat(t.radius):5,i=e.data,a=e.width,o=e.height,r=(e,t)=>4*(t*a+e),s=new Uint8ClampedArray(i);for(let l=0;l<o;l++)for(let e=0;e<a;e++){let t=0,c=0,d=0,u=0,p=0;for(let i=-n;i<=n;i++)for(let h=-n;h<=n;h++){const n=e+h,m=l+i;if(n>=0&&n<a&&m>=0&&m<o){const e=r(n,m);t+=s[e],c+=s[e+1],d+=s[e+2],u+=s[e+3],p++}}const h=r(e,l);i[h]=t/p,i[h+1]=c/p,i[h+2]=d/p,i[h+3]=u/p}})),render:e=>{let{filterArgs:t,setFilterArgs:n}=e;return(0,i.jsx)(c.xu,{children:(0,i.jsx)(x.Z,{w:"100%",id:"filter_arg",title:"Blur radius",mb:4,helperText:"Enter the blur radius.",info:"This is where you enter the blur radius.",type:x.Z.TYPES.text,value:null===t||void 0===t?void 0:t.radius,onChange:e=>{n({...t,radius:(isNaN(e),e)})}},"filter_arg")})}}},y=n(85461),k=n(53754);const j=e=>{let{children:t}=e;return(0,i.jsxs)(r.U,{justifyContent:"flex-start",alignItems:"center",m:"0px !important",mb:"1rem !important",children:[(0,i.jsx)(u.gJy,{color:"#e53e3e"}),"\xa0",(0,i.jsx)(s.x,{as:"div",color:"#e53e3e",children:t})]})},S=(e,t,n,i,a,o,r,s,l)=>{if("image_select"==i.type){if(o[i.id]){const r=o[i.id];e.children[n].attributes["xlink:href"]=(0,g.gJ)(r,a,l?"_".concat(l):null),e.children[n].attributes["data-click-field-id"]=i.id,e.children[n].attributes["data-click-element-id"]=t}}else if(["image_upload","sign"].includes(i.type))a[i.id]&&(e.children[n].attributes["xlink:href"]=a[i.id],e.children[n].attributes["data-click-field-id"]=i.id,e.children[n].attributes["data-click-element-id"]=t);else if("checkbox"==i.type)o[i.id]&&"image"==e.children[n].name&&(e.children[n].attributes["xlink:href"]=(0,g.gJ)(i.id,a,l?"_".concat(l):null));else if("qrcode"==i.type)o[i.id]&&"image"==e.children[n].name&&(e.children[n].attributes["xlink:href"]=(0,g.gJ)(i.id,a,l?"_".concat(l):null));else if(["text","textarea"].includes(i.type)){for(var c=e.children[n].children[0];c.children&&c.children.length>0;)c=c.children[0];c.value=o[i.id]||"No ".concat(i.name," entered")}},_=(e,t,n,i)=>new Promise((async(n,a)=>{((e,t,n)=>new Promise((async(i,a)=>{try{const a=Object.entries(e).map((async e=>{let[i,a]=e;var o,r,s=i.split("_")[0];let l;["image_upload","sign"].includes(null===(o=n.fields[s])||void 0===o?void 0:o.type)?(console.info("parsedSvg.maskimg2 ",i,a,s,t[s]),l=t[s]):l=await(0,m.tY)(a);const c="image_select"==(null===(r=n.fields[s])||void 0===r?void 0:r.type)?s:i;return s.startsWith("Logo.upload")&&console.info("parsedSvg.mask.logo",c,"url:".concat(a),(n.masks||{})[c],l&&!(0,k.N4)(l)&&(0,g.zI)(l)&&n.masks&&n.masks[c]),l&&!(0,k.N4)(l)&&(0,g.zI)(l)&&n.masks&&n.masks[c]&&(l=await b[n.masks[c].filter_id].filter(l,n.masks[c].args)),[i,l]})),o=await Promise.all(a);i(Object.fromEntries(o))}catch(o){a(o)}})))({...t.images},e,t).then((o=>{console.info("parsedSvg.maskdata",o,e),(0,h.parse)(t.svg).then((async r=>{const s=Object.keys(t.fields),l=parseInt("".concat(r.attributes.width||0)),c=parseInt("".concat(r.attributes.height||0));for(var d=0;d<r.children.length;d++){const n=r.children[d],{name:a,type:l,selectIndex:c,typeAndSelectIndex:u}=(0,f.py)(n.attributes.id),p="".concat(a,".").concat(l);s.includes(p)&&S(r,n.attributes.id,d,t.fields[p],o,e,0,0,i)}e.is_freemium?(0,m.wL)("/res/watermark.png",l,c,.5).then((e=>{r.children.push({name:"image",type:"element",value:"",attributes:{id:"watermark-"+(0,g.Bu)(8),width:l+"",height:c+"","xlink:href":e},children:[]}),console.info("parsedSvg:image_selectw",r),n((0,h.stringify)(r))})).catch(a):n((0,h.stringify)(r))})).catch((e=>{a(e)}))})).catch((e=>{a(e)}))})),T=e=>{let{isLoading:t,data:n,templateData:s,showWatermark:u,width:h,onFiltersUpdated:m}=e;const f=(0,p.useRef)(null),g=(0,l.S)(h||{base:0}),[w,k]=(0,p.useState)(),[S,T]=(0,p.useState)(),[O,C]=(0,p.useState)();(0,p.useEffect)((()=>{n&&s&&(T(!0),C(void 0),_(n,s,0,g).then((e=>{T(!1),k(e)})).catch((e=>{T(!1),C(e.message)})))}),[n,s,g]);const[E,I]=(0,p.useState)(),[N,P]=(0,p.useState)(),[D,Z]=(0,p.useState)(),[z,U]=(0,p.useState)(),F=e=>{P(null),I(null),Z(null),U(null)};return(0,p.useEffect)((()=>{const e=e=>{const t=e.target;if(t&&t.hasAttribute("data-click-element-id")){((e,t)=>{I(t),P(e),e&&(null===s||void 0===s?void 0:s.masks)&&(null===s||void 0===s?void 0:s.masks[e])&&(U(s.masks[e].args),Z(s.masks[e].filter_id))})(t.getAttribute("data-click-element-id"),t.getAttribute("data-click-field-id"))}},t=f.current;return t&&t.addEventListener("click",e),()=>{t&&t.removeEventListener("click",e)}}),[w,s,n]),(0,i.jsxs)(c.xu,{id:"AirlineDocWrapper",pos:"relative",w:"100%",children:[w?(0,i.jsx)(c.xu,{ref:f,w:"100%",h:"100%",dangerouslySetInnerHTML:{__html:w}}):null,(0,i.jsx)(r.U,{pos:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"1",bg:"#dfdfdf",opacity:"0.7",justifyContent:"flex-start",pl:{base:"0px",md:"0px"},alignItems:"center",display:S||t?"flex":"none",w:"100%",h:"100%",children:(0,i.jsx)(a.Z,{type:a.Z.TYPES.grid,color:(0,o.Z)("colorAccent.light","colorAccent.dark"),size:"70px"})}),(0,i.jsx)(d.g,{pos:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"1",bg:"#fff",opacity:"0.7",justifyContent:"center",pl:"1rem",alignItems:"flex-start",display:O?"flex":"none",w:"100%",h:"100%",children:O?(0,i.jsx)(j,{children:(A=O,(null===A||void 0===A?void 0:A.message)?A.message:A)}):null}),N&&m?(0,i.jsxs)(v.Z,{title:"".concat(N||""," filter"),isOpen:!0,onClose:()=>{F()},dontCloseOnOverlayClick:!0,children:[(0,i.jsx)(x.Z,{w:"100%",mb:4,id:"filter",title:"Select Filter",helperText:"Select a filter you want applied on the user's image choice.",info:"This is the status you select a filter to apply to the user's image choice.",type:x.Z.TYPES.select,value:D||"",options:["none",...Object.keys(b)],onOptionValue:e=>e,onOptionName:e=>"none"==e?"--No Filter--":e,onChange:e=>{"none"==e?(Z(null),U(null)):(Z(e),U(null))}},"filter"),D&&b[D].render?b[D].render({filterArgs:z,setFilterArgs:U}):null,(0,i.jsx)(c.xu,{mb:"1rem",children:(0,i.jsx)(y.Z,{status:"warning",mb:"1rem",onClick:()=>{if(m){const e={...(null===s||void 0===s?void 0:s.masks)||{},[N]:D?{filter_id:D,args:z}:null};m(e)}F()},children:"Apply Filter"})})]}):null]});var A};T.getSvg=_;var O=T},3683:function(e,t,n){var i=n(67294),a=n(5121),o=n(8561),r=n(94713),s=n(53754),l=n(16344);t.Z=e=>{const{user:t}=(0,l.P)(),[n,c]=(0,i.useState)(),[d,u]=(0,i.useState)(),[p,h]=(0,i.useState)({}),[m,f]=(0,i.useState)(!1),[g,x]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),[b,y]=(0,i.useState)(),[k,j]=(0,i.useState)(),[S,_]=(0,i.useState)(),[T,O]=(0,i.useState)(),[C,E]=(0,i.useState)(),[I,N]=(0,i.useState)(),P=e=>{if(!e)return null;var t=e.split("-")[1];return t?t.split(".")[0].trim():null},D=e=>{if(1==Object.keys(e).length)return Object.keys(e)[0];for(const t of Object.values(e))if(t.is_default)return t.id;return Object.keys(e)[0]};(0,i.useEffect)((()=>{const t=P(e);e&&e!=n&&t?(c(e),f(!0),y(null),a.Z.get(e).then((e=>{u(t),h((0,o.Dn)(e.data)),f(!1)})).catch((e=>{y(e.message),f(!1)}))):e||(c(null),f(!1),y(null),u(null),h({}),_(null),O(null),E(null),N(null))}),[e]),(0,i.useEffect)((()=>{p&&Object.keys(p).length>0&&!S&&Z(D(p))}),[p]);const Z=e=>{const t=p[e];t&&!(0,s.N4)(t.data_url)&&(x(!0),j(null),a.Z.get(t.data_url).then((e=>{E({...t}),N({...e.data}),_({...t}),O({...e.data}),x(!1)})).catch((e=>{j(e.message),x(!1)})))};return{templatesLoading:m,templatesError:b,selectedTemplateLoading:g,selectedTemplateError:k,parsingTemplate:v,templates:p,selectedTemplate:S,selectedTemplateData:T,workingTemplate:C,workingTemplateData:I,setAsDefaulTemplate:e=>{if(C&&(E({...C,is_default:e}),e&&Object.keys(p).length>1)){for(const e of Object.keys(p))e!=C.id&&(p[e].is_default=!1);h(p)}},setWorkingTemplate:E,setWorkingTemplateData:N,selectTemplate:Z,parseTemplateSvg:(e,t)=>(w(!0),new Promise(((n,i)=>{(0,r.xz)(e).then((e=>{if(e){var a=S,r=T;t&&(a=null,r=null),(0,o.s7)(e,r).then((e=>{const t={id:(null===a||void 0===a?void 0:a.id)||(0,o.Bu)(8),name:(null===a||void 0===a?void 0:a.name)||"",logo:(null===a||void 0===a?void 0:a.logo)||"",data_url:(null===a||void 0===a?void 0:a.data_url)||"",is_default:(null===a||void 0===a?void 0:a.is_default)||!1};E(t),N(e),w(!1),n({template:t,templateData:e})})).catch((e=>{w(!1),i(e)}))}else w(!1),n(null)})).catch((e=>{w(!1),i(e)}))}))),saveTemplate:()=>new Promise(((e,i)=>t?C&&I?void(0,o.t9)(t,d||(0,o.Bu)(8),p,C,I,S,T,n).then((t=>{if(t){c(t);const e=P(t);u(e),h({...p,[C.id]:C}),_(C),O(I),E(C),N(I)}e(t)})).catch(i):i(new Error("No template provided yet.")):i(new Error("Please sign in")))),deleteTemplate:e=>{Object.keys(p).includes(e)||(null===C||void 0===C?void 0:C.id)!=e||Z(D(p))}}}},85431:function(e,t,n){n.d(t,{_P:function(){return s},pu:function(){return o},sH:function(){return l},tY:function(){return a},wL:function(){return c},zD:function(){return r}});var i=n(8561);const a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((async(n,a)=>{if(!(0,i.Ri)(e))return n(e);try{const t=await fetch(e),i=await t.blob(),o=new FileReader;o.onloadend=()=>{n(o.result)},o.onerror=a,o.readAsDataURL(i)}catch(o){if(console.info("parsedSvg:masks.fe",o.message),t)return n(null);a(o)}}))};function o(e,t){return console.info("parsedSvg:base64A: ",e.substring(0,32)),console.info("parsedSvg:base64B: ",t.substring(0,32)),e===t.split(",")[1]}function r(e){return function(e,t){try{const n=new URL(e);return n.searchParams.delete(t),n.toString()}catch(n){return console.error("Invalid URL:",n),e}}(e,"updates")}function s(e){const t=new URL(e),n=t.searchParams.get("updates"),i="".concat(n?parseInt(n,10)+1:1);return t.searchParams.set("updates",i),t.toString()}function l(e,t){return new Promise((async(n,i)=>{try{for(const n in e)if(e.hasOwnProperty(n)&&t.hasOwnProperty(n)){const i=e[n],r=t[n];if(i.startsWith("http")&&r.startsWith("data:image")){const e=await a(i,!0);e&&o(e,r)&&(t[n]=i)}}n(t)}catch(r){i(r)}}))}function c(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new Promise(((a,o)=>{const r=new Image;r.onload=()=>{const e=document.createElement("canvas"),s=e.getContext("2d");if(!s)return o("No canvas context");e.width=t,e.height=n,s.globalAlpha=i;for(let i=0;i<n;i+=r.height)for(let e=0;e<t;e+=r.width)s.drawImage(r,e,i,r.width,r.height);a(e.toDataURL())},r.onerror=o,r.src=e}))}},94713:function(e,t,n){n.d(t,{xz:function(){return d},mA:function(){return l},py:function(){return s}});var i=n(79230),a=n(8561);async function o(e,t){return new Promise(((n,i)=>{const a=new Image;a.onload=()=>{const e=a.width/a.height,o=t/e,r=document.createElement("canvas");r.width=t,r.height=o;const s=r.getContext("2d");if(s){s.drawImage(a,0,0,t,o);const e=r.toDataURL("image/png");n(e)}else i(new Error("Failed to get canvas context"))},a.onerror=e=>{i(new Error("Failed to load image: ".concat(e)))},a.src=e}))}const r=e=>e.replace(/_/g," ").split("@")[0],s=e=>{const[t,n]=e.split(".");if(!n)return{name:t};const[i,a]=n.split("_");return{name:t,type:i,selectIndex:a,typeAndSelectIndex:n}},l=e=>{const[t,n]=e.split("@");return{name:t,directive:n}},c=(e,t,n)=>{const{name:i,type:o,selectIndex:l,typeAndSelectIndex:c}=s(t);if(!c)return{field:null,updatedFields:e};const d={};switch(o){case"select":var u;d.id="".concat(i,".").concat(o),d.name=r(i),d.type="".concat(n,"_").concat(o);const s={name:"".concat(r(i)," ").concat(l),id:t,index:l||0,type:n};d.options=(0,a.VS)({...(null===(u=e[d.id])||void 0===u?void 0:u.options)||{},[s.id]:s});break;case"upload":d.id="".concat(i,".").concat(o),d.name=r(i),d.type="".concat(n,"_").concat(o);break;default:d.id="".concat(i,".").concat(o),d.name=r(i),d.type=o}return Object.keys(d).length>0&&(e[d.id]=d),{field:d,updatedFields:e}},d=e=>new Promise((async(t,n)=>{try{e?(0,i.parse)((0,a.rY)(e)).then((async e=>{const r={};var d=[],u=[];const p=[];var h={};const m=[],f=[];var g,x;for(const t of e.children){const e=(t.attributes.id||(0,a.Bu)(8)).replace(/^_+|_+$/g,"");t.attributes.id=e;const{field:n,updatedFields:i}=c(h,e,t.name);if(h=i,"image"==t.name){if(["image_upload","sign"].includes((null===n||void 0===n?void 0:n.type)||""))r[e]="";else if(d.includes(t.attributes["xlink:href"])){const n=d.indexOf(t.attributes["xlink:href"]);r[e]=u[n]}else r[e]=t.attributes["xlink:href"],d.push(t.attributes["xlink:href"]),u.push(e);t.attributes["xlink:href"]="",n&&"image_select"==n.type&&p.push(e)}if(n)if("image_select"==n.type)t.attributes.id=n.id,f.includes(n.type)||(m.push(t),f.push(n.type));else{const{name:i}=s(e),{directive:a}=l(i);a&&"name"==a?g=e:a&&"desc"==a&&(x=e),m.push(t),f.push(n.type)}else m.push(t)}if(!g||!x){let e;return e=g||x?g?"Make sure that at least @desc is declared on a text field. @small is optional.":"Make sure that at least @name is declared on a text field. @small is optional.":"Make sure that at least @name and @desc is declared on some text fields. @small is optional.",n(new Error(e))}d=[],u=[],e.children=m;const v=e.attributes.width||"2",w=await(0,a.WN)(r,(async(e,t)=>{const{width:n}=await(i=t,new Promise(((e,t)=>{const n=new Image;n.onload=()=>{e({width:n.width,height:n.height})},n.onerror=e=>{t(new Error("Failed to load image: ".concat(e)))},n.src=i})));var i,a={};return n==parseInt(v)&&(a={["".concat(e)]:await o(t,1024),["".concat(e,"_728")]:await o(t,728),["".concat(e,"_512")]:await o(t,512)}),p.includes(e)&&(a["".concat(e,"_thumbnail")]=await o(t,70)),Object.keys(a).length>0?a:null}));t({svg:(0,i.stringify)(e),fields:h,images:w})})).catch((e=>{console.log("parsedSvg:result.error!!!: ",e.message),n(e)})):t(null)}catch(r){n(r)}}))},8561:function(e,t,n){n.d(t,{rY:function(){return u},WN:function(){return h},Bu:function(){return p},gJ:function(){return k},zI:function(){return y},Ri:function(){return b},s7:function(){return w},Dn:function(){return x},VS:function(){return g},t9:function(){return j}});var i=n(5121),a=n(11802);function o(e){const t=e.split("."),n=t.length>1&&t.pop()||"";return{name:t.join("."),ext:n}}const r=e=>new Promise((t=>setTimeout(t,e))),s=async function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=[];for(const d of t){const{id:t,file:u,fileName:p,dir:h,onFileName:m}=d,{name:f,ext:g}=o(u.name),x=m?m(f,g):p||u.name;try{const o=await e.getIdToken(),r=await i.Z.post("".concat(a.Lu,"/get-presigned-url"),{id:t,fileName:x,fileType:u.type,dir:h},{headers:{Authorization:o}}),{presignedUrl:s}=r.data;if(200===(await i.Z.put(s,u,{headers:{"Content-Type":u.type}})).status){const e=n?"".concat(n).concat(n.endsWith("/")?"":"/").concat(h||"").concat((h||"").endsWith("/")?"":"/").concat(x):s.split("?")[0];l.push({id:t,url:e})}else l.push({id:t,url:"",error:"Upload failed"})}catch(c){console.log("parsedSvg: error",t,c),l.push({id:t,url:"",error:c.message})}await r(s)}return l};var l=n(53754),c=n(85431),d=n(21876).Buffer;function u(e){const t="data:image/svg+xml;base64,";e.startsWith(t)&&(e=e.slice(t.length));const n=function(e){if("undefined"!==typeof d)return d.from(e,"base64").toString("binary");if("function"===typeof window.atob)return window.atob(e);throw new Error("Base64 decoding not supported in this environment")}(e),i=new Array(n.length);for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o);const a=new Uint8Array(i);return new TextDecoder("utf-8").decode(a)}function p(e){const t="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let i=0;i<e;i++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}function h(e,t){return new Promise((async(n,i)=>{try{const i={...e};for(const[n,a]of Object.entries(e))if(a&&y(a)){const e=await t(n,a);e&&Object.assign(i,e)}n(i)}catch(a){i(a)}}))}function m(e,t){const[n,i]=t.split(","),a=n.match(/data:(.*?);base64/);if(!a)throw new Error("Invalid base64 image format");const o=a[1],r=atob(i),s=r.length,l=new Uint8Array(s);for(let u=0;u<s;u++)l[u]=r.charCodeAt(u);const c=new Blob([l],{type:o}),d="".concat(e,".").concat(o.split("/")[1]);return{id:e,image:new File([c],d,{type:o})}}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data.json";const n=JSON.stringify(e,null,2),i=new Blob([n],{type:"application/json"}),a=new File([i],t,{type:"application/json"});return a}function g(e){const t=Object.entries(e);t.sort(((e,t)=>{let[,n]=e,[,i]=t;const a=(n.index||"").toString(),o=(i.index||"").toString();return a.localeCompare(o)}));const n={};for(const[i,a]of t)n[i]=a;return n}const x=e=>{const t=Object.entries(e);t.sort(((e,t)=>{const n=e[1].name.toUpperCase(),i=t[1].name.toUpperCase();return n<i?-1:n>i?1:0}));const n={};return t.forEach((e=>{let[t,i]=e;n[t]=i})),n};function v(e,t){return b(e)&&(0,c.zD)(e).toLowerCase()===(0,c.zD)(t).toLowerCase()}const w=(e,t)=>new Promise((async(n,i)=>{if(!t)return n(e);const a={};a.svg=e.svg;const o=[];for(const[r,s]of Object.entries(t.fields)){const t=e.fields[r];if(t){if(t.type!=s.type)o.push("The ".concat(s.type.split("_").join(" "),' field, "').concat(s.name,'" is misrepresented as "').concat(t.type.split("_").join(" "),'" in the new template.'));else if(s.options&&!(null===t||void 0===t?void 0:t.options))o.push("The ".concat(s.type.split("_").join(" "),' field, "').concat(s.name,'" is missing options in the new template.'));else if(s.options&&t.options)for(const e of Object.values(s.options))t.options[e.id]?t.options[e.id].type!=e.type&&o.push("The ".concat(s.type.split("_").join(" ")," ").concat(s.name,' option, "').concat(e.name,'" is misrepresented as "').concat(t.options[e.id].type.split("_").join(" "),'" in the new template.')):o.push("The ".concat(s.type.split("_").join(" ")," ").concat(s.name,' option, "').concat(e.name,'" is missing in the new template.'))}else o.push("The ".concat(s.type.split("_").join(" "),' field, "').concat(s.name,'" is missing in the new template.'))}if(Object.keys(t.images||{}).length>0&&0==Object.keys(e.images||{}).length)o.push("Images are missing in missing in the new template.");else if(Object.keys(t.images||{}).length>0)for(const r of Object.keys(t.images))e.images[r]||r.includes(".select")||o.push("The image with the id, ".concat(r," is missing in the new template."));a.fields={...t.fields,...e.fields};for(const[e,t]of Object.entries(a.fields))t.options&&(a.fields[e].options=g(t.options));if(a.images=await(0,c.sH)(t.images,{...t.images,...e.images}),o.length>0)return i(new Error(o.join("\n")));n(a)})),b=e=>e.startsWith("http"),y=e=>e.startsWith("data:image")||e.startsWith("data:img"),k=(e,t,n)=>{var i=t[e];return!i||b(i)||y(i)?i&&(i=t["".concat(e).concat(n||"")]):i=t["".concat(t[e]).concat(n||"")],!i&&n&&(i=t[e]),i},j=(e,t,n,i,a,r,d,u)=>new Promise((async(p,h)=>{try{const _=[];if(i.id||_.push("ID is missing in the template"),i.name||_.push("Please provide the template's name"),i.logo||_.push("Please provide the template's logo"),_.length>0)return h(new Error(_.join("\n")));const T=i.id;if(console.info("parsedSvg:base64BB:oldTemplate?.logo ",null===r||void 0===r?void 0:r.logo),console.info("parsedSvg:base64BB:template.logo ",i.logo),console.info("parsedSvg:base64BB:isImageDataUrl ",y(i.logo)),(null===r||void 0===r?void 0:r.logo)&&b(r.logo)&&y(i.logo)){const e=r.logo,t=await(0,c.tY)(e,!0);console.info("parsedSvg:base64BB:2 ",t?t.substring(0,32):"NULL"),t&&(0,c.pu)(t,i.logo)&&(i.logo=r.logo,console.info("parsedSvg:oldTemplate.logo ",r.logo))}const O=[];for(const[e,n]of Object.entries(a.images))if(y(n)){const{image:i}=m(e,n);O.push({id:e,file:i,fileName:"templates-".concat(t,"-").concat(T,"-").concat(e,"-image.").concat(o(i.name).ext),dir:"templates"})}const C="templates-".concat(t,"-").concat(T,"-logo");if(y(i.logo)){const e=m(C,i.logo);O.push({id:C,file:e.image,fileName:"".concat(C,".").concat(o(e.image.name).ext),dir:"templates"})}const E=await s(e,O,"https://r2.softbaker.com/");console.info("parsedSvg:imagesUploadResults",E,O);const I={};var g=null,x=null;if(E.forEach((e=>{(0,l.N4)(e.error)||(x=new Error(e.error)),e.id!=C?I[e.id]=e.url:g=e.url})),x)return h(x);for(const[e,t]of Object.entries(I))d&&k(e,d.images)&&v(k(e,d.images),t)?a.images[e]=(0,c._P)(k(e,d.images)):a.images[e]=t;g&&((null===r||void 0===r?void 0:r.logo)&&v(r.logo,g)?i.logo=(0,c._P)(r.logo):i.logo=g),console.info("parsedSvg:templateWithLogo",i);var w=null;if(a.svg!=(null===d||void 0===d?void 0:d.svg)||JSON.stringify(a.fields)!=JSON.stringify((null===d||void 0===d?void 0:d.fields)||{})||JSON.stringify(a.images)!=JSON.stringify((null===d||void 0===d?void 0:d.images)||{})||JSON.stringify(a.masks)!=JSON.stringify((null===d||void 0===d?void 0:d.masks)||{})){const n=f(a),i="templates-".concat(t,"-").concat(T,"-data");if(w=await s(e,[{id:i,file:n,fileName:"".concat(i,".").concat(o(n.name).ext),dir:"templates"}],"https://r2.softbaker.com/"),console.info("parsedSvg:uploadedData",w),!(0,l.N4)(w[0].error))return h(new Error(w[0].error))}var j=null;if(i.name!==(null===r||void 0===r?void 0:r.name)||i.logo!==(null===r||void 0===r?void 0:r.logo)||i.is_default!==(null===r||void 0===r?void 0:r.is_default)||w){w&&((null===r||void 0===r?void 0:r.data_url)&&v(r.data_url,w[0].url)?i.data_url=(0,c._P)(r.data_url):i.data_url=w[0].url);const a=f({...n,[T]:i}),d="templates-".concat(t);if(j=await s(e,[{id:d,file:a,fileName:"".concat(d,".").concat(o(a.name).ext),dir:"templates"}],"https://r2.softbaker.com/"),console.info("parsedSvg:uploadedTemplates",j[0].url,j),!(0,l.N4)(j[0].error))return h(new Error(j[0].error))}var S=j?j[0].url:null;u&&S&&v(u,S)&&(S=(0,c._P)(u)),p(S)}catch(_){h(_)}}))},75863:function(e,t,n){var i=n(85893),a=n(51857),o=n.n(a),r=n(34292),s=n(57747),l=n(71293),c=n(85970),d=n(5418),u=n(6089),p=n(67294),h=n(94345),m=n(53754),f=n(49626);const g=e=>{let{id:t,link:n,downloadImage:a,title:o,image:c,thumbnail:d,...u}=e;return(0,i.jsxs)(r.U,{cursor:"pointer",justifyContent:"flex-start",alignItems:"flex-end",mb:4,...u,children:[(0,i.jsx)(s.xu,{as:"image",w:"40px",h:"40px",backgroundColor:"#dfdfdf",style:{backgroundImage:"url(".concat(d,")")},backgroundRepeat:"no-repeat",backgroundSize:"cover"}),(0,i.jsx)(l.x,{as:"div",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:o})]})};t.Z=e=>{let{title:t,helperText:n,info:a,textTransform:x,labelEndIcon:v,image:w,thumbnail:b,imageTitle:y,options:k,onChange:j,disabled:S,..._}=e;const[T,O]=(0,p.useState)(!1);return(0,i.jsxs)(s.xu,{..._,children:[(0,i.jsxs)(c.NI,{opacity:S?.4:1,cursor:S?"not-allowed":"pointer",children:[(0,i.jsxs)(r.U,{w:"100%",justifyContent:"space-between",alignItems:"center",children:[!t||(0,m.N4)(a)||S?(0,i.jsx)(d.l,{textTransform:x||"capitalize",mb:"0px",children:t}):(0,i.jsx)(f.Z,{as:d.l,info:a,textTransform:x||"capitalize",children:t}),v||null]}),(0,i.jsxs)(r.U,{className:"image-selector-button",onClick:e=>{e.preventDefault(),S||O(!0)},children:[(0,i.jsx)(s.xu,{width:"auto",height:"40px",bg:"#dfdfdf",children:b?(0,i.jsx)(u.E,{src:b,width:"auto",h:"40px",objectFit:"cover"}):null}),(0,i.jsx)(l.x,{as:"div",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:y})]}),(0,m.N4)(n)||S?null:(0,i.jsx)(c.Q6,{children:n})]}),(0,i.jsx)(h.Z,{title:t,isOpen:T,onClose:()=>{O(!1)},overflowY:"auto",children:(k||[]).map(((e,t)=>(0,i.jsx)(g,{...e,onClick:()=>{j(e),O(!1)}},t)))}),(0,i.jsx)(o(),{id:"95178590041dfe1a",children:".image-selector-button{width:100%;min-width:0px;outline:2px solid transparent;outline-offset:2px;position:relative;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-transition-property:var(--chakra-transition-property-common);-moz-transition-timing-function:var(--chakra-transition-property-common);-o-transition-timing-function:var(--chakra-transition-property-common);transition-property:var(--chakra-transition-property-common);-webkit-transition-duration:var(--chakra-transition-duration-normal);-moz-transition-duration:var(--chakra-transition-duration-normal);-o-transition-duration:var(--chakra-transition-duration-normal);transition-duration:var(--chakra-transition-duration-normal);font-size:var(--chakra-fontSizes-md);-webkit-padding-start:var(--chakra-space-4);-moz-padding-start:var(--chakra-space-4);padding-inline-start:var(--chakra-space-4);-webkit-padding-end:var(--chakra-space-10);-moz-padding-end:var(--chakra-space-10);padding-inline-end:var(--chakra-space-10);height:var(--chakra-sizes-10);-webkit-border-radius:var(--chakra-radii-md);-moz-border-radius:var(--chakra-radii-md);border-radius:var(--chakra-radii-md);border:1px solid;border-color:inherit;background:inherit}"})]})}},62122:function(e,t,n){var i=n(85893),a=n(51857),o=n.n(a),r=n(34292),s=n(6089),l=n(71293),c=n(57747),d=n(85970),u=n(49626),p=n(36238),h=n(67294),m=n(94345),f=n(86201),g=n(55154);const x=e=>{let{id:t,name:n,logo:a,onDelete:o,...d}=e;return(0,i.jsxs)(r.U,{cursor:"pointer",justifyContent:"space-between",alignItems:"flex-end",mb:1,mx:"0.5rem",...d,children:[(0,i.jsxs)(r.U,{justifyContent:"flex-start",alignItems:"flex-end",children:[(0,i.jsx)(s.E,{src:a||"/res/svg-icon.png",w:"35px",h:"35px",borderRadius:"5px",border:"1px solid #dfdfdf"}),(0,i.jsx)(l.x,{as:"div",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:n||"No name yet"})]}),o?(0,i.jsx)(c.xu,{p:"0.5rem",onClick:()=>{o(t)},children:(0,i.jsx)(g.Xm5,{color:"#e53e3e"})}):null]})};t.Z=e=>{let{id:t,title:n,templates:a,createdTemplatesKeys:g,value:v,onChange:w,onNewTemplateSvgUploaded:b,disabled:y,errorMessage:k,info:j,helperText:S,onDelete:_,contactLink:T,...O}=e;const[C,E]=(0,h.useState)(!1),[I,N]=(0,h.useState)(),[P,D]=(0,h.useState)([]);return(0,h.useEffect)((()=>{v&&N(v)}),[v]),(0,i.jsxs)(c.xu,{...O,children:[(0,i.jsxs)(d.NI,{opacity:y?.4:1,cursor:y?"not-allowed":"pointer",children:[(0,i.jsx)(u.Z,{textTransform:"capitalize",info:j,children:n}),(0,i.jsxs)(r.U,{className:"image-selector-button",onClick:e=>{e.preventDefault(),y||E(!0)},children:[I?(0,i.jsx)(s.E,{src:I.logo||"/res/svg-icon.png",w:"35px",h:"35px",borderRadius:"5px",border:"1px solid #dfdfdf"}):null,(0,i.jsx)(l.x,{as:"div",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:I?I.name||"No name yet":"Select Template"})]})]}),(0,i.jsx)(p.Z,{type:p.Z.TYPES.none,helperText:S,errorMessage:k}),C?(0,i.jsxs)(m.Z,{title:n,isOpen:!0,onClose:()=>{E(!1)},children:[b?(0,i.jsx)(r.U,{children:(0,i.jsx)(f.Z,{showAsButton:!0,isOtherFiles:!0,w:"100%",id:"Form_".concat(t,"logo"),title:"Add Template",mb:4,info:"This is where you upload your SVG file to generate a template from.",helperText:"Click to select upload an SVG file to use as a template.",message:"Drag and Drop file here",hoverMessage:"Drop the file here",ruleMessage:"Make sure you're uploading a .svg file.",useImageText:"Use File",onChange:(e,t)=>{E(!1),b(e,t)}},"Form_".concat(t,"logo"))}):null,(0,i.jsxs)(c.xu,{height:"50vh",pos:"relative",overflowY:"auto",children:[Object.values(a).map(((e,t)=>(0,i.jsx)(x,{...e,onClick:()=>{E(!1),w(e)},border:v&&v.id===(null===e||void 0===e?void 0:e.id)?"1px dashed":"none",borderRadius:v&&v.id===(null===e||void 0===e?void 0:e.id)?"5px":"0px",_hover:{opacity:"0.4"},onDelete:g&&g.length>0&&!g.includes(e.id)?_:null},t))),!b&&T?(0,i.jsxs)(c.xu,{w:"100%",textAlign:"center",fontSize:"14px",pb:"0.5rem",children:[(0,i.jsx)(l.x,{as:"div",children:"Can't find the type you want?"}),(0,i.jsx)(l.x,{as:"a",href:T,target:"_blank",color:"#38a169",textDecoration:"underline",children:"Click here to tell us what you want."})]}):null]})]}):null,(0,i.jsx)(o(),{id:"42ccd62b5c30613c",children:".image-selector-button{width:100%;min-width:0px;outline:2px solid transparent;outline-offset:2px;position:relative;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-transition-property:var(--chakra-transition-property-common);-moz-transition-timing-function:var(--chakra-transition-property-common);-o-transition-timing-function:var(--chakra-transition-property-common);transition-property:var(--chakra-transition-property-common);-webkit-transition-duration:var(--chakra-transition-duration-normal);-moz-transition-duration:var(--chakra-transition-duration-normal);-o-transition-duration:var(--chakra-transition-duration-normal);transition-duration:var(--chakra-transition-duration-normal);font-size:var(--chakra-fontSizes-md);-webkit-padding-start:var(--chakra-space-4);-moz-padding-start:var(--chakra-space-4);padding-inline-start:var(--chakra-space-4);-webkit-padding-end:var(--chakra-space-10);-moz-padding-end:var(--chakra-space-10);padding-inline-end:var(--chakra-space-10);height:var(--chakra-sizes-10);-webkit-border-radius:var(--chakra-radii-md);-moz-border-radius:var(--chakra-radii-md);border-radius:var(--chakra-radii-md);border:1px solid;border-color:inherit;background:inherit}"})]})}}}]);